<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
        <title>genomicranges.GenomicRanges - GenomicRanges 0.7.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">GenomicRanges 0.7.2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <span class="sidebar-brand-text">GenomicRanges 0.7.2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html"><code class="docutils literal notranslate"><span class="pre">GenomicRanges</span></code>: Genomic analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#construct-a-genomicranges-object">Construct a <code class="docutils literal notranslate"><span class="pre">GenomicRanges</span></code> object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#sequence-information">Sequence information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#subset-operations">Subset operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#intra-range-transformations">Intra-range transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#inter-range-methods">Inter-range methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#set-operations">Set operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#compute-over-bins">Compute over bins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#generate-tiles-or-bins">Generate tiles or bins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#coverage">Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#overlap-based-methods">Overlap based methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#search-operations">Search operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#comparison-rank-and-order-operations">Comparison, rank and order operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#combine-genomicranges-objects-by-rows">Combine <code class="docutils literal notranslate"><span class="pre">GenomicRanges</span></code> objects by rows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#misc-operations">Misc operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#genomicrangeslist-class"><code class="docutils literal notranslate"><span class="pre">GenomicRangesList</span></code> class</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/modules.html">Module Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Module Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/genomicranges.html">genomicranges package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of genomicranges package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/genomicranges.io.html">genomicranges.io package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributions &amp; Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for genomicranges.GenomicRanges</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">cpu_count</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">warnings</span><span class="w"> </span><span class="kn">import</span> <span class="n">warn</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">biocutils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ut</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">biocframe</span><span class="w"> </span><span class="kn">import</span> <span class="n">BiocFrame</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">iranges</span><span class="w"> </span><span class="kn">import</span> <span class="n">IRanges</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.SeqInfo</span><span class="w"> </span><span class="kn">import</span> <span class="n">SeqInfo</span><span class="p">,</span> <span class="n">merge_SeqInfo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">STRAND_MAP</span><span class="p">,</span>
    <span class="n">compute_up_down</span><span class="p">,</span>
    <span class="n">group_by_indices</span><span class="p">,</span>
    <span class="n">sanitize_strand_vector</span><span class="p">,</span>
    <span class="n">wrapper_follow_precede</span><span class="p">,</span>
    <span class="n">wrapper_nearest</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;jkanche&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;jkanche&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>

<span class="n">_granges_delim</span> <span class="o">=</span> <span class="s2">&quot;__&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_guess_num_ranges</span><span class="p">(</span><span class="n">seqnames</span><span class="p">,</span> <span class="n">ranges</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seqnames</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of &#39;seqnames&#39; and &#39;ranges&#39; do not match!&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">seqnames</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_seqnames</span><span class="p">(</span><span class="n">seqnames</span><span class="p">,</span> <span class="n">seqinfo</span><span class="p">,</span> <span class="n">num_ranges</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">seqnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;seqnames&#39; cannot be None!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seqnames</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_ranges</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Length of &#39;seqnames&#39; does not match the number of ranges.&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Need to be </span><span class="si">{</span><span class="n">num_ranges</span><span class="si">}</span><span class="s2">, provided </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">seqnames</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">seqnames</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;seqnames&#39; cannot contain None values.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">,</span> <span class="n">SeqInfo</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;seqinfo&#39; is not an instance of `SeqInfo` class.&quot;</span><span class="p">)</span>

    <span class="n">_l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">seqnames</span> <span class="o">&gt;</span> <span class="n">_l</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;seqnames&#39; contains sequence name not represented in &#39;seqinfo&#39;.&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_ranges</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="n">num_ranges</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ranges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;ranges&#39; cannot be None.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="n">IRanges</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;ranges&#39; is not an instance of `IRanges`.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_ranges</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Length of &#39;ranges&#39; does not match the number of seqnames.&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Need to be </span><span class="si">{</span><span class="n">num_ranges</span><span class="si">}</span><span class="s2">, provided </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_optional_attrs</span><span class="p">(</span><span class="n">strand</span><span class="p">,</span> <span class="n">mcols</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">num_ranges</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">strand</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strand</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_ranges</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Length of &#39;strand&#39; does not match the number of ranges.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">strand</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;strand&#39; cannot contain None values.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mcols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mcols</span><span class="p">,</span> <span class="n">BiocFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;mcols&#39; is not a `BiocFrame` object.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mcols</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">num_ranges</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Length of &#39;mcols&#39; does not match the number of ranges.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_ranges</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Length of &#39;names&#39; does not match the number of ranges.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;names&#39; cannot contain None values.&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="GenomicRangesIter">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRangesIter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GenomicRangesIter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An iterator to a :py:class:`~GenomicRanges` object.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="GenomicRangesIter.__init__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRangesIter.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the iterator.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj:</span>
<span class="sd">                Source object to iterate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_index</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="GenomicRangesIter.__iter__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRangesIter.__iter__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="GenomicRangesIter.__next__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRangesIter.__next__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="p">):</span>
            <span class="n">iter_row_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_index</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="n">iter_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">iter_row_index</span><span class="p">,</span> <span class="n">iter_slice</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">StopIteration</span></div>
</div>



<div class="viewcode-block" id="GenomicRanges">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GenomicRanges</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;``GenomicRanges`` provides a container class to represent and operate over genomic regions and annotations.</span>

<span class="sd">    Note: The documentation for some of the methods are derived from the</span>
<span class="sd">    `GenomicRanges R/Bioconductor package &lt;https://github.com/Bioconductor/GenomicRanges&gt;`_.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GenomicRanges.__init__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">seqnames</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">ranges</span><span class="p">:</span> <span class="n">IRanges</span><span class="p">,</span>
        <span class="n">strand</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mcols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BiocFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seqinfo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a ``GenomicRanges`` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            seqnames:</span>
<span class="sd">                List of sequence or chromosome names.</span>

<span class="sd">            ranges:</span>
<span class="sd">                Genomic positions and widths of each position. Must have the same length as ``seqnames``.</span>

<span class="sd">            strand:</span>
<span class="sd">                Strand information for each genomic range. This should be 0 (any strand),</span>
<span class="sd">                1 (forward strand) or -1 (reverse strand). If None, all genomic ranges</span>
<span class="sd">                are assumed to be 0 (any strand).</span>

<span class="sd">                May be provided as a list of strings representing the strand;</span>
<span class="sd">                &quot;+&quot; for forward strand, &quot;-&quot; for reverse strand, or &quot;*&quot; for any strand and will be mapped</span>
<span class="sd">                to 1, -1 or 0 respectively.</span>

<span class="sd">            names:</span>
<span class="sd">                Names for each genomic range.</span>
<span class="sd">                Defaults to None, which means the ranges are unnamed.</span>

<span class="sd">            mcols:</span>
<span class="sd">                A ~py:class:`~biocframe.BiocFrame.BiocFrame` with the number of rows same as</span>
<span class="sd">                number of genomic ranges, containing per-range annotation.</span>
<span class="sd">                Defaults to None, in which case an empty BiocFrame object is created.</span>

<span class="sd">            seqinfo:</span>
<span class="sd">                Sequence information. Defaults to None, in which case a</span>
<span class="sd">                :py:class:`~genomicranges.SeqInfo.SeqInfo` object is created with the unique set of</span>
<span class="sd">                chromosome names from ``seqnames``.</span>

<span class="sd">            metadata:</span>
<span class="sd">                Additional metadata.</span>
<span class="sd">                Defaults to None, and is assigned to an empty dictionary.</span>

<span class="sd">            validate:</span>
<span class="sd">                Internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">seqinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seqinfo</span> <span class="o">=</span> <span class="n">SeqInfo</span><span class="p">(</span><span class="n">seqnames</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">seqnames</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span> <span class="o">=</span> <span class="n">seqinfo</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_seqindex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_seqnames</span><span class="p">(</span><span class="n">seqnames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span> <span class="o">=</span> <span class="n">ranges</span>

        <span class="k">if</span> <span class="n">strand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">strand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">strand</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span> <span class="o">=</span> <span class="n">sanitize_strand_vector</span><span class="p">(</span><span class="n">strand</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">Names</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">Names</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="n">names</span>

        <span class="k">if</span> <span class="n">mcols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mcols</span> <span class="o">=</span> <span class="n">BiocFrame</span><span class="p">({},</span> <span class="n">number_of_rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span> <span class="o">=</span> <span class="n">mcols</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">metadata</span> <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">_num_ranges</span> <span class="o">=</span> <span class="n">_guess_num_ranges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">)</span>
            <span class="n">_validate_ranges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span> <span class="n">_num_ranges</span><span class="p">)</span>
            <span class="n">_validate_seqnames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">,</span> <span class="n">_num_ranges</span><span class="p">)</span>
            <span class="n">_validate_optional_attrs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">_num_ranges</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_build_reverse_seqindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqinfo</span><span class="p">:</span> <span class="n">SeqInfo</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_seqindex</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">reverse_index</span><span class="o">.</span><span class="n">build_reverse_index</span><span class="p">(</span><span class="n">seqinfo</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_reverse_seqindex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_seqindex</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sanitize_seqnames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqnames</span><span class="p">,</span> <span class="n">seqinfo</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_seqindex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_reverse_seqindex</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seqnames</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">seqnames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_reverse_seqindex</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seqnames</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seqnames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">seqnames</span> <span class="o">=</span> <span class="n">seqnames</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_uniq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">seqnames</span><span class="p">)</span>
                <span class="n">_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">_dtype</span> <span class="ow">in</span> <span class="n">_types</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">num_uniq</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                        <span class="n">seqnames</span> <span class="o">=</span> <span class="n">seqnames</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_dtype</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">seqnames</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_define_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">in_place</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>

    <span class="c1">#########################</span>
    <span class="c1">######&gt;&gt; Copying &lt;&lt;######</span>
    <span class="c1">#########################</span>

<div class="viewcode-block" id="GenomicRanges.__deepcopy__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.__deepcopy__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_nil</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            A deep copy of the current ``GenomicRanges``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>

        <span class="n">_ranges_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">)</span>
        <span class="n">_seqnames_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">)</span>
        <span class="n">_strand_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">)</span>
        <span class="n">_names_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">)</span>
        <span class="n">_mcols_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="p">)</span>
        <span class="n">_seqinfo_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">)</span>
        <span class="n">_metadata_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

        <span class="n">current_class_const</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">current_class_const</span><span class="p">(</span>
            <span class="n">seqnames</span><span class="o">=</span><span class="n">_seqnames_copy</span><span class="p">,</span>
            <span class="n">ranges</span><span class="o">=</span><span class="n">_ranges_copy</span><span class="p">,</span>
            <span class="n">strand</span><span class="o">=</span><span class="n">_strand_copy</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="n">_names_copy</span><span class="p">,</span>
            <span class="n">mcols</span><span class="o">=</span><span class="n">_mcols_copy</span><span class="p">,</span>
            <span class="n">seqinfo</span><span class="o">=</span><span class="n">_seqinfo_copy</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">_metadata_copy</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.__copy__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.__copy__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            A shallow copy of the current ``GenomicRanges``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_class_const</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">current_class_const</span><span class="p">(</span>
            <span class="n">seqnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">,</span>
            <span class="n">ranges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span>
            <span class="n">strand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span>
            <span class="n">mcols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="p">,</span>
            <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.copy">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.copy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~__copy__`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span></div>


    <span class="c1">######################################</span>
    <span class="c1">######&gt;&gt; length and iterators &lt;&lt;######</span>
    <span class="c1">######################################</span>

<div class="viewcode-block" id="GenomicRanges.__len__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.__len__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            Number of rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.__iter__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.__iter__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenomicRangesIter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterator over rows.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GenomicRangesIter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="c1">##########################</span>
    <span class="c1">######&gt;&gt; Printing &lt;&lt;######</span>
    <span class="c1">##########################</span>

<div class="viewcode-block" id="GenomicRanges.__repr__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.__repr__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            A string representation of this ``GenomicRanges``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;GenomicRanges(number_of_ranges=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;, seqnames=&quot;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">print_truncated_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;, ranges=&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;, strand=&quot;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">print_truncated_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;, names=&quot;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">print_truncated_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;, mcols=&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;, seqinfo&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;, metadata=&quot;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">print_truncated_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            A pretty-printed string containing the contents of this ``GenomicRanges``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;GenomicRanges with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> range</span><span class="si">{</span><span class="s1">&#39;s&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">())</span><span class="si">}</span><span class="s2"> metadata column</span><span class="si">{</span><span class="s1">&#39;s&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">added_table</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">nr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nr</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span>
                <span class="n">insert_ellipsis</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nr</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nr</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">insert_ellipsis</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">raw_floating</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">create_floating_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">insert_ellipsis</span><span class="p">:</span>
                <span class="n">raw_floating</span> <span class="o">=</span> <span class="n">raw_floating</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">raw_floating</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">floating</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">raw_floating</span>

            <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;seqnames&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;str&gt;&quot;</span><span class="p">]</span>
            <span class="n">_seqnames</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="n">indices</span><span class="p">]:</span>
                <span class="n">_seqnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">()[</span><span class="n">x</span><span class="p">])</span>

            <span class="n">showed</span> <span class="o">=</span> <span class="n">_seqnames</span>
            <span class="k">if</span> <span class="n">insert_ellipsis</span><span class="p">:</span>
                <span class="n">showed</span> <span class="o">=</span> <span class="n">showed</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">showed</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="n">showed</span><span class="p">)</span>

            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ranges&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;IRanges&gt;&quot;</span><span class="p">]</span>
            <span class="n">showed</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">[</span><span class="n">indices</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">insert_ellipsis</span><span class="p">:</span>
                <span class="n">showed</span> <span class="o">=</span> <span class="n">showed</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">showed</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="n">showed</span><span class="p">)</span>

            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="n">ut</span><span class="o">.</span><span class="n">print_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span><span class="p">]</span>
            <span class="n">_strand</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">indices</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_strand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">_strand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_strand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>

            <span class="n">showed</span> <span class="o">=</span> <span class="n">_strand</span>
            <span class="k">if</span> <span class="n">insert_ellipsis</span><span class="p">:</span>
                <span class="n">showed</span> <span class="o">=</span> <span class="n">showed</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">showed</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="n">showed</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">spacer</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;|&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">+</span> <span class="n">insert_ellipsis</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">spacer</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">showed</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">show_as_cell</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
                    <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">print_type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">]</span>
                    <span class="n">showed</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truncate_strings</span><span class="p">(</span><span class="n">showed</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                    <span class="k">if</span> <span class="n">insert_ellipsis</span><span class="p">:</span>
                        <span class="n">showed</span> <span class="o">=</span> <span class="n">showed</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">showed</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="n">showed</span><span class="p">)</span>

            <span class="n">output</span> <span class="o">+=</span> <span class="n">ut</span><span class="o">.</span><span class="n">print_wrapped_table</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">floating_names</span><span class="o">=</span><span class="n">floating</span><span class="p">)</span>
            <span class="n">added_table</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">footer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">):</span>
            <span class="n">footer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;seqinfo(&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot; sequences): &quot;</span>
                <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">print_truncated_list</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(),</span>
                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="n">include_brackets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">):</span>
            <span class="n">footer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;metadata(&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;): &quot;</span>
                <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">print_truncated_list</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
                    <span class="n">include_brackets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">footer</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">added_table</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">------</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="c1">##########################</span>
    <span class="c1">######&gt;&gt; seqnames &lt;&lt;######</span>
    <span class="c1">##########################</span>

<div class="viewcode-block" id="GenomicRanges.get_seqnames">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_seqnames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_seqnames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;factor&quot;</span><span class="p">,</span> <span class="s2">&quot;list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;list&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">Factor</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access sequence names.</span>

<span class="sd">        Args:</span>
<span class="sd">            as_type:</span>
<span class="sd">                Access seqnames as factor tuple, in which case, levels and codes</span>
<span class="sd">                are returned.</span>

<span class="sd">                If ``list``, then codes are mapped to levels and returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A :py:class:`biocutils.Factor` if `as_type=&quot;factor&quot;`.</span>
<span class="sd">            Otherwise a list of sequence names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;factor&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ut</span><span class="o">.</span><span class="n">Factor</span><span class="p">(</span><span class="n">codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">()[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;as_type&#39; must be &#39;factor&#39; or &#39;list&#39;.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.set_seqnames">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.set_seqnames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_seqnames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqnames</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set new sequence names.</span>

<span class="sd">        Args:</span>
<span class="sd">            seqnames:</span>
<span class="sd">                List of sequence or chromosome names.</span>
<span class="sd">                Optionally can be a numpy array with indices mapped</span>
<span class="sd">                to :py:attr:``~seqinfo``.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object, either as a copy of the original</span>
<span class="sd">            or as a reference to the (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_validate_seqnames</span><span class="p">(</span><span class="n">seqnames</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seqnames</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">seqnames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">seqnames</span><span class="p">)])</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_seqnames</span> <span class="o">=</span> <span class="n">seqnames</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">seqnames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~get_seqnames`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">()</span>

    <span class="nd">@seqnames</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">seqnames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqnames</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~set_seqnames` with ``in_place = True``.</span>

<span class="sd">        As this mutates the original object, a warning is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Setting property &#39;seqnames&#39; is an in-place operation, use &#39;set_seqnames&#39; instead&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_seqnames</span><span class="p">(</span><span class="n">seqnames</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">########################</span>
    <span class="c1">######&gt;&gt; ranges &lt;&lt;######</span>
    <span class="c1">########################</span>

<div class="viewcode-block" id="GenomicRanges.get_ranges">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_ranges">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IRanges</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            An ``IRanges`` object containing the positions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span></div>


<div class="viewcode-block" id="GenomicRanges.set_ranges">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.set_ranges">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span><span class="p">:</span> <span class="n">IRanges</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set new ranges.</span>

<span class="sd">        Args:</span>
<span class="sd">            ranges:</span>
<span class="sd">                IRanges containing the genomic positions and widths.</span>
<span class="sd">                Must have the same length as ``seqnames``.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object, either as a copy of the original</span>
<span class="sd">            or as a reference to the (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_validate_ranges</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span> <span class="o">=</span> <span class="n">ranges</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IRanges</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~get_ranges`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ranges</span><span class="p">()</span>

    <span class="nd">@ranges</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span><span class="p">:</span> <span class="n">IRanges</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~set_ranges` with ``in_place = True``.</span>

<span class="sd">        As this mutates the original object, a warning is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Setting property &#39;ranges&#39; is an in-place operation, use &#39;set_ranges&#39; instead&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ranges</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">########################</span>
    <span class="c1">######&gt;&gt; strand &lt;&lt;######</span>
    <span class="c1">########################</span>

<div class="viewcode-block" id="GenomicRanges.get_strand">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_strand">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_strand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">as_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="s2">&quot;factor&quot;</span><span class="p">,</span> <span class="s2">&quot;list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access strand information.</span>

<span class="sd">        Args:</span>
<span class="sd">            as_type:</span>
<span class="sd">                Access seqnames as factor codes, in which case, a numpy</span>
<span class="sd">                 vector is retuned.</span>

<span class="sd">                If ``factor``, a tuple with codes as the strand vector</span>
<span class="sd">                and levels a dictionary containing the mapping.</span>

<span class="sd">                If ``list``, then codes are mapped to levels and returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A numpy vector representing strand, 0</span>
<span class="sd">            for any strand, -1 for reverse strand</span>
<span class="sd">            and 1 for forward strand.</span>

<span class="sd">            A tuple of codes and levels.</span>

<span class="sd">            A list of &quot;+&quot;, &quot;-&quot;, or &quot;*&quot; for each range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span>
        <span class="k">elif</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;factor&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;-1&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
            <span class="n">_strand</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_strand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">_strand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_strand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_strand</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;as_type&#39; must be &#39;factor&#39; or &#39;list&#39;.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.set_strand">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.set_strand">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_strand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">strand</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set new strand information.</span>

<span class="sd">        Args:</span>
<span class="sd">            strand:</span>
<span class="sd">                Strand information for each genomic range. This should be 0 (any strand),</span>
<span class="sd">                1 (forward strand) or -1 (reverse strand).</span>

<span class="sd">                Alternatively, may provide a list of strings representing the strand;</span>
<span class="sd">                &quot;+&quot; for forward strand, &quot;-&quot; for reverse strand, or &quot;*&quot; for any strand</span>
<span class="sd">                and will be automatically mapped to 1, -1 or 0 respectively.</span>

<span class="sd">                May be set to None; in which case all genomic ranges are assumed to be 0.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object, either as a copy of the original</span>
<span class="sd">            or as a reference to the (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">strand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">strand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">strand</span> <span class="o">=</span> <span class="n">sanitize_strand_vector</span><span class="p">(</span><span class="n">strand</span><span class="p">)</span>
        <span class="n">_validate_optional_attrs</span><span class="p">(</span><span class="n">strand</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_strand</span> <span class="o">=</span> <span class="n">strand</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">strand</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~get_strand`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_strand</span><span class="p">()</span>

    <span class="nd">@strand</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">strand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strand</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~set_strand` with ``in_place = True``.</span>

<span class="sd">        As this mutates the original object, a warning is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Setting property &#39;strand&#39; is an in-place operation, use &#39;set_strand&#39; instead&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_strand</span><span class="p">(</span><span class="n">strand</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">########################</span>
    <span class="c1">######&gt;&gt; names &lt;&lt;#######</span>
    <span class="c1">########################</span>

<div class="viewcode-block" id="GenomicRanges.get_names">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ut</span><span class="o">.</span><span class="n">Names</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            A list of names for each genomic range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span></div>


<div class="viewcode-block" id="GenomicRanges.set_names">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.set_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set new names.</span>

<span class="sd">        Args:</span>
<span class="sd">            names:</span>
<span class="sd">                Names for each genomic range.</span>
<span class="sd">                May be `None` to remove names.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object, either as a copy of the original</span>
<span class="sd">            or as a reference to the (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_validate_optional_attrs</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">ut</span><span class="o">.</span><span class="n">Names</span><span class="p">):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">Names</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="n">names</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ut</span><span class="o">.</span><span class="n">Names</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~get_names`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_names</span><span class="p">()</span>

    <span class="nd">@names</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~set_names` with ``in_place = True``.</span>

<span class="sd">        As this mutates the original object, a warning is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Setting property &#39;names&#39; is an in-place operation, use &#39;set_names&#39; instead&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_names</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">########################</span>
    <span class="c1">######&gt;&gt; mcols &lt;&lt;#######</span>
    <span class="c1">########################</span>

<div class="viewcode-block" id="GenomicRanges.get_mcols">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_mcols">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mcols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BiocFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            A ~py:class:`~biocframe.BiocFrame.BiocFrame` containing per-range annotations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span></div>


<div class="viewcode-block" id="GenomicRanges.set_mcols">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.set_mcols">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_mcols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BiocFrame</span><span class="p">],</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set new range metadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            mcols:</span>
<span class="sd">                A ~py:class:`~biocframe.BiocFrame.BiocFrame` with length same as the number</span>
<span class="sd">                of ranges, containing per-range annotations.</span>

<span class="sd">                May be None to remove range metadata.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object, either as a copy of the original</span>
<span class="sd">            or as a reference to the (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">mcols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mcols</span> <span class="o">=</span> <span class="n">BiocFrame</span><span class="p">({},</span> <span class="n">number_of_rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">_validate_optional_attrs</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">mcols</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_mcols</span> <span class="o">=</span> <span class="n">mcols</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mcols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BiocFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~get_mcols`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mcols</span><span class="p">()</span>

    <span class="nd">@mcols</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mcols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BiocFrame</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~set_mcols` with ``in_place = True``.</span>

<span class="sd">        As this mutates the original object, a warning is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Setting property &#39;mcols&#39; is an in-place operation, use &#39;set_mcols&#39; instead&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_mcols</span><span class="p">(</span><span class="n">mcols</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">##########################</span>
    <span class="c1">######&gt;&gt; seqinfo &lt;&lt;#######</span>
    <span class="c1">##########################</span>

<div class="viewcode-block" id="GenomicRanges.get_seqinfo">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_seqinfo">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_seqinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SeqInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            A ~py:class:`~genomicranges.SeqInfo.SeqInfo` containing sequence information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span></div>


<div class="viewcode-block" id="GenomicRanges.set_seqinfo">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.set_seqinfo">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_seqinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seqinfo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">],</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set new sequence information.</span>

<span class="sd">        Args:</span>
<span class="sd">            seqinfo:</span>
<span class="sd">                A ~py:class:`~genomicranges.SeqInfo.SeqInfo` object containing information</span>
<span class="sd">                about sequences in :py:attr:`~seqnames`.</span>

<span class="sd">                May be None to remove sequence information. This would then generate a</span>
<span class="sd">                new sequence information based on the current sequence names.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object, either as a copy of the original</span>
<span class="sd">            or as a reference to the (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seqnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(</span><span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">seqinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seqinfo</span> <span class="o">=</span> <span class="n">SeqInfo</span><span class="p">(</span><span class="n">seqnames</span><span class="o">=</span><span class="n">seqnames</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_seqindex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">new_seqnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_seqnames</span><span class="p">(</span><span class="n">seqnames</span><span class="p">,</span> <span class="n">seqinfo</span><span class="p">)</span>

        <span class="n">_validate_seqnames</span><span class="p">(</span><span class="n">new_seqnames</span><span class="p">,</span> <span class="n">seqinfo</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_seqinfo</span> <span class="o">=</span> <span class="n">seqinfo</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_seqnames</span> <span class="o">=</span> <span class="n">new_seqnames</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">seqinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~get_seqinfo`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_seqinfo</span><span class="p">()</span>

    <span class="nd">@seqinfo</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">seqinfo</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">seqinfo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:meth:`~set_seqinfo` with ``in_place = True``.</span>

<span class="sd">        As this mutates the original object, a warning is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Setting property &#39;seqinfo&#39; is an in-place operation, use &#39;set_seqinfo&#39; instead&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_seqinfo</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">###########################</span>
    <span class="c1">######&gt;&gt; metadata &lt;&lt;#######</span>
    <span class="c1">###########################</span>

<div class="viewcode-block" id="GenomicRanges.get_metadata">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_metadata">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionary of metadata for this object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span></div>


<div class="viewcode-block" id="GenomicRanges.set_metadata">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.set_metadata">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set additional metadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            metadata:</span>
<span class="sd">                New metadata for this object.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object, either as a copy of the original</span>
<span class="sd">            or as a reference to the (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`metadata` must be a dictionary, provided </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:attr:`~get_metadata`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">()</span>

    <span class="nd">@metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:attr:`~set_metadata` with ``in_place = True``.</span>

<span class="sd">        As this mutates the original object, a warning is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Setting property &#39;metadata&#39; is an in-place operation, use &#39;set_metadata&#39; instead&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">################################</span>
    <span class="c1">######&gt;&gt; Single getters &lt;&lt;######</span>
    <span class="c1">################################</span>

<div class="viewcode-block" id="GenomicRanges.get_start">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_start">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all start positions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumPy array of 32-bit signed integers containing the start</span>
<span class="sd">            positions for all ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:attr:`~get_start`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span>

<div class="viewcode-block" id="GenomicRanges.get_end">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_end">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all end positions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumPy array of 32-bit signed integers containing the end</span>
<span class="sd">            positions for all ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:attr:`~get_end`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>

<div class="viewcode-block" id="GenomicRanges.get_width">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_width">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get width of each genomic range.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumPy array of 32-bit signed integers containing the width</span>
<span class="sd">            for all ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias for :py:attr:`~get_width`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span>

<div class="viewcode-block" id="GenomicRanges.get_seqlengths">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_seqlengths">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_seqlengths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get sequence lengths for each genomic range.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An ndarray containing the sequence lengths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seqlenths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqlengths</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">seqlenths</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">])</span></div>


    <span class="c1">#########################</span>
    <span class="c1">######&gt;&gt; Slicers &lt;&lt;######</span>
    <span class="c1">#########################</span>

<div class="viewcode-block" id="GenomicRanges.get_subset">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_subset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subset ``GenomicRanges``, based on their indices or names.</span>

<span class="sd">        Args:</span>
<span class="sd">            subset:</span>
<span class="sd">                Indices to be extracted. This may be an integer, boolean, string,</span>
<span class="sd">                or any sequence thereof, as supported by</span>
<span class="sd">                :py:meth:`~biocutils.normalize_subscript.normalize_subscript`.</span>
<span class="sd">                Scalars are treated as length-1 sequences.</span>

<span class="sd">                Strings may only be used if :py:attr:``~names`` are available (see</span>
<span class="sd">                :py:meth:`~get_names`). The first occurrence of each string</span>
<span class="sd">                in the names is used for extraction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` object with the ranges of interest.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GenomicRanges</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>

        <span class="n">idx</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">normalize_subscript</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">)</span>

        <span class="n">current_class_const</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">current_class_const</span><span class="p">(</span>
            <span class="n">seqnames</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span>
            <span class="n">ranges</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span>
            <span class="n">strand</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span>
            <span class="n">names</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">mcols</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span>
            <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.__getitem__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.__getitem__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias to :py:attr:`~get_subset`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subset</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.set_subset">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.set_subset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">range</span><span class="p">],</span>
        <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Udate positions.</span>

<span class="sd">        Args:</span>
<span class="sd">            args:</span>
<span class="sd">                Integer indices, a boolean filter, or (if the current object is</span>
<span class="sd">                named) names specifying the ranges to be replaced, see</span>
<span class="sd">                :py:meth:`~biocutils.normalize_subscript.normalize_subscript`.</span>

<span class="sd">            value:</span>
<span class="sd">                An ``GenomicRanges`` object of length equal to the number of ranges</span>
<span class="sd">                to be replaced, as specified by ``subset``.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object, either as a copy of the original</span>
<span class="sd">            or as a reference to the (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;value&#39; to assign must be a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="n">idx</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">normalize_subscript</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_seqnames</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_ranges</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_strand</span>

        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
                <span class="n">output</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">output</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
                <span class="n">output</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">_mcols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">_mcols</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_mcols</span>

        <span class="k">if</span> <span class="n">in_place</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">delete_nclist_index</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="GenomicRanges.__setitem__">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.__setitem__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">range</span><span class="p">],</span>
        <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alias to :py:attr:`~set_subset`.</span>

<span class="sd">        This operation modifies object in-place.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Modifying a subset of the object is an in-place operation, use &#39;set_subset&#39; instead&quot;</span><span class="p">,</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_subset</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="c1">################################</span>
    <span class="c1">######&gt;&gt; pandas interop &lt;&lt;######</span>
    <span class="c1">################################</span>

<div class="viewcode-block" id="GenomicRanges.to_pandas">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.to_pandas">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert this ``GenomicRanges`` to a :py:class:`~pandas.DataFrame` object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A :py:class:`~pandas.DataFrame` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

        <span class="n">_rdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
        <span class="n">_rdf</span><span class="p">[</span><span class="s2">&quot;seqnames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">()</span>
        <span class="n">_rdf</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_strand</span><span class="p">(</span><span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_rdf</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_rdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_rdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_rdf</span></div>


<div class="viewcode-block" id="GenomicRanges.from_pandas">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.from_pandas">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_pandas</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an ``GenomicRanges`` object from a :py:class:`~pandas.DataFrame`.</span>

<span class="sd">        Args:</span>
<span class="sd">            input:</span>
<span class="sd">                Input data. Must contain columns &#39;seqnames&#39;, &#39;starts&#39; and &#39;widths&#39; or &quot;ends&quot;.</span>
<span class="sd">                &#39;ends&#39; are expected to be inclusive.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A ``GenomicRanges`` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataFrame</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`input` is not a pandas `DataFrame` object.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;starts&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;input&#39; must contain column &#39;starts&#39;.&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;starts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;widths&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s2">&quot;ends&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;input&#39; must contain either &#39;widths&#39; or &#39;ends&#39; columns.&quot;</span><span class="p">)</span>

        <span class="n">drops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;widths&quot;</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">drops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;widths&quot;</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;widths&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">drops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ends&quot;</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;ends&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;starts&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="s2">&quot;seqnames&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;input&#39; must contain column &#39;seqnames&#39;.&quot;</span><span class="p">)</span>
        <span class="n">seqnames</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;seqnames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">ranges</span> <span class="o">=</span> <span class="n">IRanges</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="n">strand</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;strand&quot;</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">strand</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">drops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;strand&quot;</span><span class="p">)</span>

        <span class="c1"># mcols</span>
        <span class="n">drops</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;starts&quot;</span><span class="p">,</span> <span class="s2">&quot;seqnames&quot;</span><span class="p">])</span>
        <span class="n">mcols_df</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drops</span><span class="p">)</span>

        <span class="n">mcols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">mcols_df</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcols_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcols</span> <span class="o">=</span> <span class="n">BiocFrame</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">mcols_df</span><span class="p">)</span>

        <span class="n">names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">seqnames</span><span class="o">=</span><span class="n">seqnames</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">mcols</span><span class="o">=</span><span class="n">mcols</span><span class="p">)</span></div>


    <span class="c1">################################</span>
    <span class="c1">######&gt;&gt; polars interop &lt;&lt;######</span>
    <span class="c1">################################</span>

<div class="viewcode-block" id="GenomicRanges.to_polars">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.to_polars">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_polars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert this ``GenomicRanges`` to a :py:class:`~polars.DataFrame` object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A :py:class:`~polars.DataFrame` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>

        <span class="n">_rdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span>
        <span class="n">_rdf</span> <span class="o">=</span> <span class="n">_rdf</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">seqnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(),</span> <span class="n">strand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_strand</span><span class="p">(</span><span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_rdf</span> <span class="o">=</span> <span class="n">_rdf</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">rownames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_rdf</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_rdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_rdf</span></div>


<div class="viewcode-block" id="GenomicRanges.from_polars">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.from_polars">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_polars</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an ``GenomicRanges`` object from a :py:class:`~polars.DataFrame`.</span>

<span class="sd">        Args:</span>
<span class="sd">            input:</span>
<span class="sd">                Input polars DataFrame. Must contain columns &#39;seqnames&#39;, &#39;starts&#39; and &#39;widths&#39; or &quot;ends&quot;.</span>
<span class="sd">                &#39;ends&#39; are expected to be inclusive.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A ``GenomicRanges`` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataFrame</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`input` is not a polars `DataFrame` object.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;starts&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;input&#39; must contain column &#39;starts&#39;.&quot;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;starts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;widths&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s2">&quot;ends&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;input&#39; must contain either &#39;widths&#39; or &#39;ends&#39; columns.&quot;</span><span class="p">)</span>

        <span class="n">drops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;widths&quot;</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">drops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;widths&quot;</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;widths&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">drops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ends&quot;</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;ends&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;starts&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="s2">&quot;seqnames&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;input&#39; must contain column &#39;seqnames&#39;.&quot;</span><span class="p">)</span>
        <span class="n">seqnames</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;seqnames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="n">ranges</span> <span class="o">=</span> <span class="n">IRanges</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="n">strand</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;strand&quot;</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">strand</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="n">drops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;strand&quot;</span><span class="p">)</span>

        <span class="c1"># mcols</span>
        <span class="n">drops</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;starts&quot;</span><span class="p">,</span> <span class="s2">&quot;seqnames&quot;</span><span class="p">])</span>
        <span class="n">mcols_df</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">drops</span><span class="p">)</span>

        <span class="n">mcols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">mcols_df</span><span class="o">.</span><span class="n">is_empty</span><span class="p">())</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcols_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcols</span> <span class="o">=</span> <span class="n">BiocFrame</span><span class="o">.</span><span class="n">from_polars</span><span class="p">(</span><span class="n">mcols_df</span><span class="p">)</span>

        <span class="n">names</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">seqnames</span><span class="o">=</span><span class="n">seqnames</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">mcols</span><span class="o">=</span><span class="n">mcols</span><span class="p">)</span></div>


    <span class="c1">#####################################</span>
    <span class="c1">######&gt;&gt; intra-range methods &lt;&lt;######</span>
    <span class="c1">#####################################</span>

<div class="viewcode-block" id="GenomicRanges.flank">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.flank">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">flank</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">both</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute flanking ranges for each range. The logic for this comes from the `R/GenomicRanges` &amp; `IRanges`</span>
<span class="sd">        packages.</span>

<span class="sd">        If ``start`` is ``True`` for a given range, the flanking occurs at the `start`,</span>
<span class="sd">        otherwise the `end`.</span>
<span class="sd">        The `widths` of the flanks are given by the ``width`` parameter.</span>

<span class="sd">        ``width`` can be negative, in which case the flanking region is</span>
<span class="sd">        reversed so that it represents a prefix or suffix of the range.</span>

<span class="sd">        Usage:</span>

<span class="sd">            `gr.flank(3, True)`, where &quot;x&quot; indicates a range in ``gr`` and &quot;-&quot; indicates the</span>
<span class="sd">            resulting flanking region:</span>
<span class="sd">                ---xxxxxxx</span>
<span class="sd">            If ``start`` were ``False``, the range in ``gr`` becomes</span>
<span class="sd">                xxxxxxx---</span>
<span class="sd">            For negative width, i.e. `gr.flank(x, -3, FALSE)`, where &quot;*&quot; indicates the overlap</span>
<span class="sd">            between &quot;x&quot; and the result:</span>
<span class="sd">                xxxx***</span>
<span class="sd">            If ``both`` is ``True``, then, for all ranges in &quot;x&quot;, the flanking regions are</span>
<span class="sd">            extended into (or out of, if ``width`` is negative) the range, so that the result</span>
<span class="sd">            straddles the given endpoint and has twice the width given by width.</span>

<span class="sd">            This is illustrated below for `gr.flank(3, both=TRUE)`:</span>
<span class="sd">                ---***xxxx</span>

<span class="sd">        Args:</span>
<span class="sd">            width:</span>
<span class="sd">                Width to flank by. May be negative.</span>

<span class="sd">            start:</span>
<span class="sd">                Whether to only flank starts.</span>
<span class="sd">                Defaults to True.</span>

<span class="sd">                Alternatively, you may provide a list of start values,</span>
<span class="sd">                whose length is the same as the number of ranges.</span>

<span class="sd">            both:</span>
<span class="sd">                Whether to flank both starts and ends. Defaults to False.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object with the flanked regions,</span>
<span class="sd">            either as a copy of the original or as a reference to the</span>
<span class="sd">            (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_strand</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;ignore_strand&#39; must be True or False.&quot;</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">start_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="n">start</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">start_arr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
                <span class="n">start_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">start_arr</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>  <span class="c1"># may be throw an error?</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_strand</span><span class="p">:</span>
            <span class="n">start_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start_arr</span> <span class="o">!=</span> <span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">get_strand</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">new_ranges</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">flank</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start_arr</span><span class="p">,</span> <span class="n">both</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span> <span class="o">=</span> <span class="n">new_ranges</span>
        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="GenomicRanges.resize">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.resize">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">resize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">fix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resize ranges to the specified ``width`` where either the ``start``, ``end``, or ``center`` is used as an</span>
<span class="sd">        anchor.</span>

<span class="sd">        Args:</span>
<span class="sd">            width:</span>
<span class="sd">                Width to resize, cannot be negative!</span>

<span class="sd">            fix:</span>
<span class="sd">                Fix positions by &quot;start&quot;, &quot;end&quot;, or &quot;center&quot;.</span>
<span class="sd">                Defaults to &quot;start&quot;.</span>

<span class="sd">                Alternatively, may provide a list of fix positions</span>
<span class="sd">                for each genomic range.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError:</span>
<span class="sd">                If parameter ``fix`` is neither `start`, `end`, nor `center`.</span>
<span class="sd">                If ``width`` is negative.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object with the resized regions,</span>
<span class="sd">            either as a copy of the original or as a reference to the</span>
<span class="sd">            (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_REV_FIX</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_strand</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;ignore_strand&#39; must be True or False.&quot;</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">fix_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">fix</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fix_arr</span> <span class="o">=</span> <span class="n">fix</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fix_arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">fix_arr</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of ranges is not a multiple of &#39;fix&#39; length&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignore_strand</span><span class="p">:</span>
            <span class="n">fix_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">fix_arr</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">fix_arr</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fix_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fix_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">_REV_FIX</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="k">if</span> <span class="n">strand</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">strand</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fix_arr</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">get_strand</span><span class="p">())]</span>

        <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">fix</span><span class="o">=</span><span class="n">fix_arr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="GenomicRanges.shift">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.shift">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shift all intervals.</span>

<span class="sd">        Args:</span>
<span class="sd">            shift:</span>
<span class="sd">                Shift interval. If shift is 0, the current</span>
<span class="sd">                object is returned. Defaults to 0.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object with the shifted regions,</span>
<span class="sd">            either as a copy of the original or as a reference to the</span>
<span class="sd">            (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">shift</span><span class="o">=</span><span class="n">shift</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="GenomicRanges.promoters">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.promoters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">promoters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upstream</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">downstream</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extend ranges to promoter regions.</span>

<span class="sd">        Generates promoter ranges relative to the transcription start site (TSS).</span>

<span class="sd">        Args:</span>
<span class="sd">            upstream:</span>
<span class="sd">                Number of positions to extend in the 5&#39; direction.</span>
<span class="sd">                Defaults to 2000.</span>

<span class="sd">            downstream:</span>
<span class="sd">                Number of positions to extend in the 3&#39; direction.</span>
<span class="sd">                Defaults to 200.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object with the promoter regions,</span>
<span class="sd">            either as a copy of the original or as a reference to the</span>
<span class="sd">            (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>

        <span class="n">new_starts</span><span class="p">,</span> <span class="n">new_widths</span> <span class="o">=</span> <span class="n">compute_up_down</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">get_start</span><span class="p">(),</span> <span class="n">output</span><span class="o">.</span><span class="n">get_end</span><span class="p">(),</span> <span class="n">output</span><span class="o">.</span><span class="n">get_strand</span><span class="p">(),</span> <span class="n">upstream</span><span class="p">,</span> <span class="n">downstream</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="s2">&quot;TSS&quot;</span>
        <span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span> <span class="o">=</span> <span class="n">IRanges</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">new_starts</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">new_widths</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="GenomicRanges.terminators">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.terminators">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">terminators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upstream</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">downstream</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extend ranges to termiantor regions.</span>

<span class="sd">        Generates terminator ranges relative to the transcription end site (TES).</span>

<span class="sd">        Args:</span>
<span class="sd">            upstream:</span>
<span class="sd">                Number of positions to extend in the 5&#39; direction.</span>
<span class="sd">                Defaults to 2000.</span>

<span class="sd">            downstream:</span>
<span class="sd">                Number of positions to extend in the 3&#39; direction.</span>
<span class="sd">                Defaults to 200.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object with the promoter regions,</span>
<span class="sd">            either as a copy of the original or as a reference to the</span>
<span class="sd">            (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>

        <span class="n">new_starts</span><span class="p">,</span> <span class="n">new_widths</span> <span class="o">=</span> <span class="n">compute_up_down</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">get_start</span><span class="p">(),</span> <span class="n">output</span><span class="o">.</span><span class="n">get_end</span><span class="p">(),</span> <span class="n">output</span><span class="o">.</span><span class="n">get_strand</span><span class="p">(),</span> <span class="n">upstream</span><span class="p">,</span> <span class="n">downstream</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="s2">&quot;TES&quot;</span>
        <span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span> <span class="o">=</span> <span class="n">IRanges</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">new_starts</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">new_widths</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="GenomicRanges.restrict">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.restrict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">restrict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">keep_all_ranges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restrict ranges to a given start and end positions.</span>

<span class="sd">        Args:</span>
<span class="sd">            start:</span>
<span class="sd">                Start position. Defaults to None.</span>

<span class="sd">                Alternatively may provide a dictionary</span>
<span class="sd">                mapping sequence names to starts, or array of starts.</span>

<span class="sd">            end:</span>
<span class="sd">                End position. Defaults to None.</span>

<span class="sd">                Alternatively may provide a dictionary</span>
<span class="sd">                mapping sequence names to starts, or array of starts.</span>

<span class="sd">            keep_all_ranges:</span>
<span class="sd">                Whether to keep intervals that do not overlap with start and end.</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` object with the restricted regions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">start_is_dict</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="n">end_is_dict</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">start_is_dict</span> <span class="ow">or</span> <span class="n">end_is_dict</span><span class="p">):</span>
            <span class="c1"># directly restrict ranges</span>
            <span class="n">new_ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">keep_all_ranges</span><span class="o">=</span><span class="n">keep_all_ranges</span><span class="p">)</span>

            <span class="n">new_seqnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span>
            <span class="n">new_strand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strand</span>
            <span class="n">new_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span>
            <span class="n">new_mcols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span>

            <span class="c1"># Get indices of kept ranges for filtering seqnames and strand</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_all_ranges</span><span class="p">:</span>
                <span class="n">keep_idx</span> <span class="o">=</span> <span class="n">new_ranges</span><span class="o">.</span><span class="n">get_mcols</span><span class="p">()</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;revmap&quot;</span><span class="p">)</span>

                <span class="n">new_seqnames</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">,</span> <span class="n">keep_idx</span><span class="p">)</span>
                <span class="n">new_strand</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span> <span class="n">keep_idx</span><span class="p">)</span>
                <span class="n">new_names</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">keep_idx</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="n">new_mcols</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="p">,</span> <span class="n">keep_idx</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">GenomicRanges</span><span class="p">(</span>
                <span class="n">seqnames</span><span class="o">=</span><span class="n">new_seqnames</span><span class="p">,</span>
                <span class="n">ranges</span><span class="o">=</span><span class="n">new_ranges</span><span class="p">,</span>
                <span class="n">strand</span><span class="o">=</span><span class="n">new_strand</span><span class="p">,</span>
                <span class="n">names</span><span class="o">=</span><span class="n">new_names</span><span class="p">,</span>
                <span class="n">mcols</span><span class="o">=</span><span class="n">new_mcols</span><span class="p">,</span>
                <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">start_is_dict</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="p">{</span><span class="n">seq</span><span class="p">:</span> <span class="n">start</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">)}</span>

        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">end_is_dict</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="p">{</span><span class="n">seq</span><span class="p">:</span> <span class="n">end</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">)}</span>

        <span class="n">split_indices</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">seqnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seqnames</span><span class="p">):</span>
            <span class="n">split_indices</span><span class="p">[</span><span class="n">seq</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="n">all_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_granges_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">seqnames</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">split_indices</span><span class="p">[</span><span class="n">seq</span><span class="p">]</span>
            <span class="n">seq_ranges</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">seq_seqnames</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="n">seqnames</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">seq_strand</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">seq_names</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">seq_mcols</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

            <span class="n">seq_start</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="n">seq</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">seq_end</span> <span class="o">=</span> <span class="n">end</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="n">seq</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">new_seq_ranges</span> <span class="o">=</span> <span class="n">seq_ranges</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">seq_start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">seq_end</span><span class="p">,</span> <span class="n">keep_all_ranges</span><span class="o">=</span><span class="n">keep_all_ranges</span><span class="p">)</span>

            <span class="c1"># Only keep metadata for non-dropped ranges; IRanges restrict returns a revmap</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_all_ranges</span><span class="p">:</span>
                <span class="n">keep_idx</span> <span class="o">=</span> <span class="n">new_seq_ranges</span><span class="o">.</span><span class="n">get_mcols</span><span class="p">()</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;revmap&quot;</span><span class="p">)</span>
                <span class="n">new_seqnames</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">,</span> <span class="n">keep_idx</span><span class="p">)</span>
                <span class="n">new_strand</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span> <span class="n">keep_idx</span><span class="p">)</span>
                <span class="n">new_names</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">keep_idx</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="n">new_mcols</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="p">,</span> <span class="n">keep_idx</span><span class="p">)</span>
                <span class="n">all_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keep_idx</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_seqnames</span> <span class="o">=</span> <span class="n">seq_seqnames</span>
                <span class="n">new_strand</span> <span class="o">=</span> <span class="n">seq_strand</span>
                <span class="n">new_names</span> <span class="o">=</span> <span class="n">seq_names</span>
                <span class="n">new_mcols</span> <span class="o">=</span> <span class="n">seq_mcols</span>
                <span class="n">all_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

            <span class="n">new_granges_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">GenomicRanges</span><span class="p">(</span>
                    <span class="n">seqnames</span><span class="o">=</span><span class="n">new_seqnames</span><span class="p">,</span>
                    <span class="n">ranges</span><span class="o">=</span><span class="n">new_seq_ranges</span><span class="p">,</span>
                    <span class="n">strand</span><span class="o">=</span><span class="n">new_strand</span><span class="p">,</span>
                    <span class="n">names</span><span class="o">=</span><span class="n">new_names</span><span class="p">,</span>
                    <span class="n">mcols</span><span class="o">=</span><span class="n">new_mcols</span><span class="p">,</span>
                    <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">,</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">combined_granges</span> <span class="o">=</span> <span class="n">_combine_GenomicRanges</span><span class="p">(</span><span class="o">*</span><span class="n">new_granges_list</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">all_indices</span><span class="p">)</span>
        <span class="n">ordered_granges</span> <span class="o">=</span> <span class="n">combined_granges</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ordered_granges</span></div>


<div class="viewcode-block" id="GenomicRanges.get_out_of_bound_index">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.get_out_of_bound_index">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_out_of_bound_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find indices of genomic ranges that are out of bounds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A numpy array of integer indices where ranges are out of bounds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># incase it contains NA&#39;s</span>
        <span class="n">seqlevel_is_circ</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_is_circular</span><span class="p">]</span>
        <span class="n">seqlength_is_na</span> <span class="o">=</span> <span class="p">[</span><span class="n">slength</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">slength</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqlengths</span><span class="p">]</span>
        <span class="n">seqlevel_has_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="ow">not</span> <span class="p">(</span><span class="n">circ</span> <span class="ow">or</span> <span class="n">is_na</span><span class="p">)</span> <span class="k">for</span> <span class="n">circ</span><span class="p">,</span> <span class="n">is_na</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">seqlevel_is_circ</span><span class="p">,</span> <span class="n">seqlength_is_na</span><span class="p">)]</span>

        <span class="n">out_of_bounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">starts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span>
        <span class="n">ends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seq_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">seqlevel_has_bounds</span><span class="p">[</span><span class="n">seq_id</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">starts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqlengths</span><span class="p">[</span><span class="n">seq_id</span><span class="p">]):</span>
                <span class="n">out_of_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">out_of_bounds</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.trim">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.trim">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trim sequences outside of bounds for non-circular chromosomes.</span>

<span class="sd">        Args:</span>
<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` object with the trimmed regions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot trim ranges. `seqinfo` is not available.&quot;</span><span class="p">)</span>

        <span class="n">seqlengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span><span class="o">.</span><span class="n">_seqlengths</span>
        <span class="n">is_circular</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span><span class="o">.</span><span class="n">_is_circular</span>

        <span class="k">if</span> <span class="n">seqlengths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot trim ranges. `seqlengths` is not available.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_circular</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;considering all sequences as non-circular...&quot;</span><span class="p">)</span>

        <span class="n">out_of_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_out_of_bound_index</span><span class="p">()</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_of_bounds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>

        <span class="n">filtered_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="n">out_of_bounds</span><span class="p">]</span>
        <span class="n">new_ends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_seqlengths</span><span class="p">()[</span><span class="n">filtered_seqs</span><span class="p">]</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span><span class="p">[</span><span class="n">out_of_bounds</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span><span class="p">[</span><span class="n">out_of_bounds</span><span class="p">]</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span>
            <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">new_ends</span><span class="p">,</span> <span class="n">keep_all_ranges</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="GenomicRanges.narrow">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.narrow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">narrow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Narrow genomic positions by provided ``start``, ``width`` and ``end`` parameters.</span>

<span class="sd">        Important: these parameters are relative shift in positions for each range.</span>

<span class="sd">        Args:</span>
<span class="sd">            start:</span>
<span class="sd">                Relative start position. Defaults to None.</span>

<span class="sd">            width:</span>
<span class="sd">                Relative end position. Defaults to None.</span>

<span class="sd">            end:</span>
<span class="sd">                Relative width of the interval. Defaults to None.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the ``GenomicRanges`` object in place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object with the trimmed regions,</span>
<span class="sd">            either as a copy of the original or as a reference to the</span>
<span class="sd">            (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only provide two of the three parameters - `start`, `end` and `width` but not all!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If width is provided, either start or end must be provided.&quot;</span><span class="p">)</span>

        <span class="n">narrow_ir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">narrow</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_ranges</span> <span class="o">=</span> <span class="n">narrow_ir</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="c1">#####################################</span>
    <span class="c1">######&gt;&gt; inter-range methods &lt;&lt;######</span>
    <span class="c1">#####################################</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_group_indices_by_chrm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">grouped_indices</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">seqnames_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(</span><span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignore_strand</span><span class="p">:</span>
            <span class="n">strands_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strands_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_strand</span><span class="p">(</span><span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">strand</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">seqnames_list</span><span class="p">,</span> <span class="n">strands_list</span><span class="p">)):</span>
            <span class="n">grouped_indices</span><span class="p">[(</span><span class="n">seq</span><span class="p">,</span> <span class="n">strand</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">grouped_indices</span><span class="p">)</span>

<div class="viewcode-block" id="GenomicRanges.reduce">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.reduce">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reduce</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">with_reverse_map</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">drop_empty_ranges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">min_gap_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reduce orders the ranges, then merges overlapping or adjacent ranges.</span>

<span class="sd">        Args:</span>
<span class="sd">            with_reverse_map:</span>
<span class="sd">                Whether to return map of indices back to</span>
<span class="sd">                original object. Defaults to False.</span>

<span class="sd">            drop_empty_ranges:</span>
<span class="sd">                Whether to drop empty ranges. Defaults to False.</span>

<span class="sd">            min_gap_width:</span>
<span class="sd">                Ranges separated by a gap of</span>
<span class="sd">                at least ``min_gap_width`` positions are not merged. Defaults to 1.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` object with reduced intervals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chrm_grps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_indices_by_chrm</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>

        <span class="n">_new_mcols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s2">&quot;reduceindices&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="n">_new_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_mcols</span><span class="p">(</span><span class="n">_new_mcols</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">all_grp_ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rev_map_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">group_keys</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">grp_key</span><span class="p">,</span> <span class="n">grp_indices</span> <span class="ow">in</span> <span class="n">chrm_grps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">_grp_subset</span> <span class="o">=</span> <span class="n">_new_self</span><span class="p">[</span><span class="n">grp_indices</span><span class="p">]</span>
            <span class="n">_original_indices</span> <span class="o">=</span> <span class="n">_grp_subset</span><span class="o">.</span><span class="n">mcols</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;reduceindices&quot;</span><span class="p">)</span>

            <span class="n">res_ir</span> <span class="o">=</span> <span class="n">_grp_subset</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
                <span class="n">with_reverse_map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">drop_empty_ranges</span><span class="o">=</span><span class="n">drop_empty_ranges</span><span class="p">,</span>
                <span class="n">min_gap_width</span><span class="o">=</span><span class="n">min_gap_width</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_ir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">group_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">grp_key</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_ir</span><span class="p">))</span>
                <span class="n">all_grp_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_ir</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">with_reverse_map</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">res_ir</span><span class="o">.</span><span class="n">mcols</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;revmap&quot;</span><span class="p">):</span>
                        <span class="n">rev_map_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">_original_indices</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_grp_ranges</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GenomicRanges</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>

        <span class="n">all_merged_ranges</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="n">all_grp_ranges</span><span class="p">)</span>
        <span class="n">all_merged_ranges</span><span class="o">.</span><span class="n">mcols</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;revmap&quot;</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">new_seqnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group_keys</span><span class="p">]</span>
        <span class="n">new_strand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">STRAND_MAP</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group_keys</span><span class="p">])</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">GenomicRanges</span><span class="p">(</span><span class="n">seqnames</span><span class="o">=</span><span class="n">new_seqnames</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">new_strand</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">all_merged_ranges</span><span class="p">,</span> <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">with_reverse_map</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">mcols</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s2">&quot;revmap&quot;</span><span class="p">,</span> <span class="n">rev_map_list</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">order</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">_order_for_interranges</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">[</span><span class="n">order</span><span class="p">]</span></div>


<div class="viewcode-block" id="GenomicRanges.range">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_reverse_map</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate range bounds for each distinct (seqname, strand) pair.</span>

<span class="sd">        Args:</span>
<span class="sd">            with_reverse_map:</span>
<span class="sd">                Whether to return map of indices back to</span>
<span class="sd">                original object. Defaults to False.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` object with the range bounds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chrm_grps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_indices_by_chrm</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>

        <span class="n">all_grp_ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rev_map_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">group_keys</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">grp_key</span><span class="p">,</span> <span class="n">grp_indices</span> <span class="ow">in</span> <span class="n">chrm_grps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">_grp_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">grp_indices</span><span class="p">]</span>
            <span class="n">res_ir</span> <span class="o">=</span> <span class="n">_grp_subset</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">range</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_ir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">group_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">grp_key</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_ir</span><span class="p">))</span>
                <span class="n">all_grp_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_ir</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">with_reverse_map</span><span class="p">:</span>
                    <span class="n">rev_map_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">grp_indices</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_ir</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_grp_ranges</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GenomicRanges</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>

        <span class="n">all_merged_ranges</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="n">all_grp_ranges</span><span class="p">)</span>

        <span class="n">new_seqnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group_keys</span><span class="p">]</span>
        <span class="n">new_strand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">STRAND_MAP</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group_keys</span><span class="p">])</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">GenomicRanges</span><span class="p">(</span><span class="n">seqnames</span><span class="o">=</span><span class="n">new_seqnames</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">new_strand</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">all_merged_ranges</span><span class="p">,</span> <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">with_reverse_map</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">mcols</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s2">&quot;revmap&quot;</span><span class="p">,</span> <span class="n">rev_map_list</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">order</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">_order_for_interranges</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">[</span><span class="n">order</span><span class="p">]</span></div>


<div class="viewcode-block" id="GenomicRanges.gaps">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.gaps">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify complemented ranges for each distinct (seqname, strand) pair.</span>

<span class="sd">        Args:</span>
<span class="sd">            start:</span>
<span class="sd">                Restrict chromosome start position. Defaults to 1.</span>

<span class="sd">            end:</span>
<span class="sd">                Restrict end position for each chromosome.</span>
<span class="sd">                Defaults to None. If None, extracts sequence information from</span>
<span class="sd">                :py:attr:`~seqinfo` object if available.</span>

<span class="sd">                Alternatively, you may provide a dictionary with seqnames as</span>
<span class="sd">                keys and the values specifying the ends.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` with complement ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chrm_grps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_indices_by_chrm</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>
        <span class="n">all_grp_ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">group_keys</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">all_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">()</span>
        <span class="n">all_strands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">ignore_strand</span> <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">seq_name</span> <span class="ow">in</span> <span class="n">all_seqs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">strand_str</span> <span class="ow">in</span> <span class="n">all_strands</span><span class="p">:</span>
                <span class="n">grp_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">seq_name</span><span class="p">,</span> <span class="n">strand_str</span><span class="p">)</span>

                <span class="n">_end_val</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">_end_val</span> <span class="o">=</span> <span class="n">end</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">seq_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">_end_val</span> <span class="o">=</span> <span class="n">end</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># end is None</span>
                    <span class="n">seq_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">seq_name</span><span class="p">)</span>
                    <span class="n">_end_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span><span class="o">.</span><span class="n">seqlengths</span><span class="p">[</span><span class="n">seq_idx</span><span class="p">]</span>

                <span class="n">gaps_ir</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">grp_key</span> <span class="ow">in</span> <span class="n">chrm_grps</span><span class="p">:</span>
                    <span class="n">_grp_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">chrm_grps</span><span class="p">[</span><span class="n">grp_key</span><span class="p">]]</span>
                    <span class="n">gaps_ir</span> <span class="o">=</span> <span class="n">_grp_subset</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">gaps</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">_end_val</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">_end_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># If group doesn&#39;t exist, the gap is the whole region</span>
                    <span class="n">gaps_ir</span> <span class="o">=</span> <span class="n">IRanges</span><span class="p">([</span><span class="n">start</span><span class="p">],</span> <span class="p">[</span><span class="n">_end_val</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">gaps_ir</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">gaps_ir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">all_grp_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gaps_ir</span><span class="p">)</span>
                    <span class="n">group_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">grp_key</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">gaps_ir</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_grp_ranges</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GenomicRanges</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>

        <span class="n">all_merged_ranges</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="n">all_grp_ranges</span><span class="p">)</span>

        <span class="n">new_seqnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group_keys</span><span class="p">]</span>
        <span class="n">new_strand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">STRAND_MAP</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group_keys</span><span class="p">])</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">GenomicRanges</span><span class="p">(</span><span class="n">seqnames</span><span class="o">=</span><span class="n">new_seqnames</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">new_strand</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">all_merged_ranges</span><span class="p">,</span> <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">_order_for_interranges</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">[</span><span class="n">order</span><span class="p">]</span></div>


<div class="viewcode-block" id="GenomicRanges.disjoin">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.disjoin">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">disjoin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_reverse_map</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate disjoint genomic positions for each distinct (seqname, strand) pair.</span>

<span class="sd">        Args:</span>
<span class="sd">            with_reverse_map:</span>
<span class="sd">                Whether to return a map of indices back to the original object.</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` containing disjoint ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chrm_grps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_indices_by_chrm</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>

        <span class="n">all_grp_ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rev_map_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">group_keys</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">grp_key</span><span class="p">,</span> <span class="n">grp_indices</span> <span class="ow">in</span> <span class="n">chrm_grps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">_grp_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">grp_indices</span><span class="p">]</span>
            <span class="n">res_ir</span> <span class="o">=</span> <span class="n">_grp_subset</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">disjoin</span><span class="p">(</span><span class="n">with_reverse_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_ir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">group_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">grp_key</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_ir</span><span class="p">))</span>
                <span class="n">all_grp_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_ir</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">with_reverse_map</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">res_ir</span><span class="o">.</span><span class="n">mcols</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;revmap&quot;</span><span class="p">):</span>
                        <span class="n">rev_map_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">grp_indices</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_grp_ranges</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GenomicRanges</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>

        <span class="n">all_merged_ranges</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="n">all_grp_ranges</span><span class="p">)</span>
        <span class="n">all_merged_ranges</span><span class="o">.</span><span class="n">mcols</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;revmap&quot;</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">new_seqnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group_keys</span><span class="p">]</span>
        <span class="n">new_strand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">STRAND_MAP</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group_keys</span><span class="p">])</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">GenomicRanges</span><span class="p">(</span><span class="n">seqnames</span><span class="o">=</span><span class="n">new_seqnames</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">new_strand</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">all_merged_ranges</span><span class="p">,</span> <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seqinfo</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">with_reverse_map</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">mcols</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="s2">&quot;revmap&quot;</span><span class="p">,</span> <span class="n">rev_map_list</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">order</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">_order_for_interranges</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">[</span><span class="n">order</span><span class="p">]</span></div>


<div class="viewcode-block" id="GenomicRanges.is_disjoint">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.is_disjoint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_disjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate disjoint genomic positions for each distinct (seqname, strand) pair.</span>

<span class="sd">        Args:</span>
<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all ranges are disjoint, otherwise False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chrm_grps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_indices_by_chrm</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">grp_indices</span> <span class="ow">in</span> <span class="n">chrm_grps</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">_grp_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">grp_indices</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_grp_subset</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">is_disjoint</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="GenomicRanges.disjoint_bins">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.disjoint_bins">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">disjoint_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split ranges into a set of bins so that the ranges in each bin are disjoint.</span>

<span class="sd">        Args:</span>
<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An ndarray indicating the bin index for each range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chrm_grps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_indices_by_chrm</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>

        <span class="n">binned_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">grp_indices</span> <span class="ow">in</span> <span class="n">chrm_grps</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">_grp_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">grp_indices</span><span class="p">]</span>
            <span class="n">res_ir_bins</span> <span class="o">=</span> <span class="n">_grp_subset</span><span class="o">.</span><span class="n">ranges</span><span class="o">.</span><span class="n">disjoint_bins</span><span class="p">()</span>
            <span class="n">binned_results</span><span class="p">[</span><span class="n">grp_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ir_bins</span>

        <span class="k">return</span> <span class="n">binned_results</span></div>


<div class="viewcode-block" id="GenomicRanges.coverage">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.coverage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">coverage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate coverage for each chromosome. For each position, this method</span>
<span class="sd">        counts the number of ranges that cover it.</span>

<span class="sd">        Args:</span>
<span class="sd">            shift:</span>
<span class="sd">                Shift all genomic positions. Defaults to 0.</span>

<span class="sd">            width:</span>
<span class="sd">                Restrict the width of all chromosomes. Defaults to None.</span>
<span class="sd">            weight:</span>
<span class="sd">                Weight to use for each range. Defaults to 1.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strand, effectively combining</span>
<span class="sd">                all strands for coverage calculation. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with chromosome names as keys and the</span>
<span class="sd">            coverage vector as values. The dictionary is sorted</span>
<span class="sd">            by chromosome name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chrm_grps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_indices_by_chrm</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>
        <span class="n">sorted_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">chrm_grps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">grp_key</span> <span class="ow">in</span> <span class="n">sorted_keys</span><span class="p">:</span>
            <span class="n">grp_indices</span> <span class="o">=</span> <span class="n">chrm_grps</span><span class="p">[</span><span class="n">grp_key</span><span class="p">]</span>

            <span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">[</span><span class="n">grp_indices</span><span class="p">]</span><span class="o">.</span><span class="n">coverage</span><span class="p">(</span><span class="n">shift</span><span class="o">=</span><span class="n">shift</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
            <span class="n">seq_name</span> <span class="o">=</span> <span class="n">grp_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seq_name</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">seq_name</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="p">):</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">seq_name</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">seq_name</span><span class="p">])),</span> <span class="s2">&quot;constant&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]):</span>
                    <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">seq_name</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="p">)),</span> <span class="s2">&quot;constant&quot;</span><span class="p">)</span>

                <span class="n">result</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cov</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">seq_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cov</span>

        <span class="k">return</span> <span class="n">result</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_order_for_interranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decreasing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the order of indices for sorting.</span>

<span class="sd">        Order is determined by:</span>
<span class="sd">        1. Chromosome name (alphabetical).</span>
<span class="sd">        2. Strand, in the user-specified order: &#39;+&#39;, &#39;-&#39;, &#39;*&#39;.</span>
<span class="sd">        3. Start position.</span>

<span class="sd">        Args:</span>
<span class="sd">            decreasing:</span>
<span class="sd">                Whether to sort in descending order.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A NumPy vector containing index positions in the sorted order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">strand_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="n">sorted_strands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">strand_map</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">])</span>
        <span class="n">sort_keys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">sorted_strands</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">])</span>
        <span class="n">order_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">(</span><span class="n">sort_keys</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">decreasing</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">order_indices</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">order_indices</span>

    <span class="c1">################################</span>
    <span class="c1">######&gt;&gt; set operations &lt;&lt;######</span>
    <span class="c1">################################</span>

<div class="viewcode-block" id="GenomicRanges.union">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.union">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find union of genomic intervals with `other`.</span>

<span class="sd">        Args:</span>
<span class="sd">            other:</span>
<span class="sd">                The other ``GenomicRanges`` object.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` object with all ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;other&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="n">grs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ignore_strand</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">grs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">set_strand</span><span class="p">(</span><span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">set_strand</span><span class="p">(</span><span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>

        <span class="n">all_combined</span> <span class="o">=</span> <span class="n">_combine_GenomicRanges</span><span class="p">(</span><span class="o">*</span><span class="n">grs</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">all_combined</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">drop_empty_ranges</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="GenomicRanges.setdiff">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.setdiff">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find set difference of genomic intervals with `other`.</span>

<span class="sd">        Args:</span>
<span class="sd">            other:</span>
<span class="sd">                The other ``GenomicRanges`` object.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` object with the diff ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;other&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ignore_strand</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_strand</span><span class="p">(</span><span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">set_strand</span><span class="p">(</span><span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">x</span><span class="o">.</span><span class="n">set_seqinfo</span><span class="p">(</span><span class="n">merge_SeqInfo</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">get_seqinfo</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">get_seqinfo</span><span class="p">())),</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">set_seqinfo</span><span class="p">(</span><span class="n">merge_SeqInfo</span><span class="p">((</span><span class="n">y</span><span class="o">.</span><span class="n">get_seqinfo</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">get_seqinfo</span><span class="p">())),</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">seqlengths</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqlengths</span><span class="p">()))</span>
        <span class="n">all_combs</span> <span class="o">=</span> <span class="n">_fast_combine_GenomicRanges</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">all_combs_ends</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">all_combs</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(),</span> <span class="n">all_combs</span><span class="o">.</span><span class="n">get_end</span><span class="p">()))</span>

        <span class="k">for</span> <span class="n">seq</span><span class="p">,</span> <span class="n">seqlen</span> <span class="ow">in</span> <span class="n">seqlengths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">seqlen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_val</span> <span class="o">=</span> <span class="n">all_combs_ends</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">seqlengths</span><span class="p">[</span><span class="n">seq</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_val</span><span class="p">)</span> <span class="k">if</span> <span class="n">_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">x_gaps</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">gaps</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">seqlengths</span><span class="p">)</span>
        <span class="n">x_gaps_u</span> <span class="o">=</span> <span class="n">x_gaps</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">x_gaps_u</span><span class="o">.</span><span class="n">gaps</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">seqlengths</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">diff</span></div>


<div class="viewcode-block" id="GenomicRanges.intersect">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.intersect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find intersecting genomic intervals with `other`.</span>

<span class="sd">        Args:</span>
<span class="sd">            other:</span>
<span class="sd">                The other ``GenomicRanges`` object.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` object with intersecting ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;other&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ignore_strand</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_strand</span><span class="p">(</span><span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">set_strand</span><span class="p">(</span><span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">x</span><span class="o">.</span><span class="n">set_seqinfo</span><span class="p">(</span><span class="n">merge_SeqInfo</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">get_seqinfo</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">get_seqinfo</span><span class="p">())),</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">set_seqinfo</span><span class="p">(</span><span class="n">merge_SeqInfo</span><span class="p">((</span><span class="n">y</span><span class="o">.</span><span class="n">get_seqinfo</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">get_seqinfo</span><span class="p">())),</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">seqlengths</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">get_seqlengths</span><span class="p">()))</span>
        <span class="n">all_combs</span> <span class="o">=</span> <span class="n">_fast_combine_GenomicRanges</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">all_combs_ends</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">all_combs</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(),</span> <span class="n">all_combs</span><span class="o">.</span><span class="n">get_end</span><span class="p">()))</span>

        <span class="k">for</span> <span class="n">seq</span><span class="p">,</span> <span class="n">seqlen</span> <span class="ow">in</span> <span class="n">seqlengths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">seqlen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">seqlengths</span><span class="p">[</span><span class="n">seq</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">all_combs_ends</span><span class="p">[</span><span class="n">seq</span><span class="p">])</span>

        <span class="n">y_gaps</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">gaps</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">seqlengths</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">setdiff</span><span class="p">(</span><span class="n">y_gaps</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">diff</span></div>


<div class="viewcode-block" id="GenomicRanges.intersect_ncls">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.intersect_ncls">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">intersect_ncls</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span> <span class="n">delete_index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find intersecting genomic intervals with `other` (uses NCLS index).</span>

<span class="sd">        Args:</span>
<span class="sd">            other:</span>
<span class="sd">                The other ``GenomicRanges`` object.</span>

<span class="sd">            delete_index:</span>
<span class="sd">                Defaults to True, to delete the cached ncls index.</span>
<span class="sd">                Set to False, to reuse the index across multiple queries.</span>

<span class="sd">            num_threads:</span>
<span class="sd">                Number of threads to use.</span>
<span class="sd">                Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` object with intersecting ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;other&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="n">self_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>
        <span class="n">other_end</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span>

        <span class="n">other</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">_build_ncls_index</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">find_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">delete_index</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">delete_nclist_index</span><span class="p">()</span>

        <span class="n">_other_indexes</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;self_hits&quot;</span><span class="p">]</span>
        <span class="n">_self_indexes</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;query_hits&quot;</span><span class="p">]</span>
        <span class="n">other_chrms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">other</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_other_indexes</span><span class="p">])</span>
        <span class="n">self_chrms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_self_indexes</span><span class="p">])</span>

        <span class="n">other_strands</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">_other_indexes</span><span class="p">]</span>
        <span class="n">self_strands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">_self_indexes</span><span class="p">]</span>

        <span class="n">filtered_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">other_chrms</span> <span class="o">==</span> <span class="n">self_chrms</span><span class="p">,</span> <span class="n">other_strands</span> <span class="o">==</span> <span class="n">self_strands</span><span class="p">)</span>

        <span class="n">self_starts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="n">_self_indexes</span><span class="p">][</span><span class="n">filtered_indexes</span><span class="p">]</span>
        <span class="n">other_starts</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="n">_other_indexes</span><span class="p">][</span><span class="n">filtered_indexes</span><span class="p">]</span>
        <span class="n">new_starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">self_starts</span> <span class="o">&gt;</span> <span class="n">other_starts</span><span class="p">,</span> <span class="n">self_starts</span><span class="p">,</span> <span class="n">other_starts</span><span class="p">)</span>

        <span class="n">self_ends</span> <span class="o">=</span> <span class="n">self_end</span><span class="p">[</span><span class="n">_self_indexes</span><span class="p">][</span><span class="n">filtered_indexes</span><span class="p">]</span>
        <span class="n">other_ends</span> <span class="o">=</span> <span class="n">other_end</span><span class="p">[</span><span class="n">_other_indexes</span><span class="p">][</span><span class="n">filtered_indexes</span><span class="p">]</span>
        <span class="n">new_ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">self_ends</span> <span class="o">&lt;</span> <span class="n">other_ends</span><span class="p">,</span> <span class="n">self_ends</span><span class="p">,</span> <span class="n">other_ends</span><span class="p">)</span>

        <span class="c1"># filtered_keys = self_grp_keys[filtered_indexes]</span>
        <span class="c1"># splits = [x.split(_granges_delim) for x in filtered_keys]</span>
        <span class="n">new_seqnames</span> <span class="o">=</span> <span class="n">self_chrms</span><span class="p">[</span><span class="n">filtered_indexes</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">new_strands</span> <span class="o">=</span> <span class="n">self_strands</span><span class="p">[</span><span class="n">filtered_indexes</span><span class="p">]</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">GenomicRanges</span><span class="p">(</span>
            <span class="n">seqnames</span><span class="o">=</span><span class="n">new_seqnames</span><span class="p">,</span>
            <span class="n">ranges</span><span class="o">=</span><span class="n">IRanges</span><span class="p">(</span><span class="n">new_starts</span><span class="p">,</span> <span class="n">new_ends</span> <span class="o">-</span> <span class="n">new_starts</span><span class="p">),</span>
            <span class="n">strand</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_strands</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span></div>


    <span class="c1">###################################</span>
    <span class="c1">######&gt;&gt; search operations &lt;&lt;######</span>
    <span class="c1">###################################</span>

<div class="viewcode-block" id="GenomicRanges.extract_groups_by_seqnames">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.extract_groups_by_seqnames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_groups_by_seqnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span> <span class="o">==</span> <span class="n">idx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">groups</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_get_query_common_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="c1"># smerged = merge_SeqInfo([self._seqinfo, query._seqinfo])</span>
        <span class="n">common_seqlevels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">)</span>
        <span class="n">q_group_idx</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">common_seqlevels</span><span class="p">]</span>
        <span class="n">s_group_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">_seqinfo</span><span class="o">.</span><span class="n">_seqnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">common_seqlevels</span><span class="p">]</span>

        <span class="n">s_grps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_groups_by_seqnames</span><span class="p">()</span>
        <span class="n">self_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">s_grps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">q_group_idx</span><span class="p">]</span>

        <span class="n">q_grps</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">extract_groups_by_seqnames</span><span class="p">()</span>
        <span class="n">query_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">q_grps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s_group_idx</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">self_groups</span><span class="p">,</span> <span class="n">query_groups</span><span class="p">)</span>

<div class="viewcode-block" id="GenomicRanges.find_overlaps">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.find_overlaps">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_overlaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span>
        <span class="n">query_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;within&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
        <span class="n">select</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;arbitrary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="n">max_gap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">min_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BiocFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find overlaps between subject (self) and a ``query`` ``GenomicRanges`` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            query:</span>
<span class="sd">                Query `GenomicRanges`.</span>

<span class="sd">            query_type:</span>
<span class="sd">                Overlap query type, must be one of</span>

<span class="sd">                - &quot;any&quot;: Any overlap is good</span>
<span class="sd">                - &quot;start&quot;: Overlap at the beginning of the intervals</span>
<span class="sd">                - &quot;end&quot;: Must overlap at the end of the intervals</span>
<span class="sd">                - &quot;within&quot;: Fully contain the query interval</span>

<span class="sd">                Defaults to &quot;any&quot;.</span>

<span class="sd">            select:</span>
<span class="sd">                Determine what hit to choose when</span>
<span class="sd">                there are multiple hits for an interval in ``subject``.</span>

<span class="sd">            max_gap:</span>
<span class="sd">                Maximum gap allowed in the overlap.</span>
<span class="sd">                Defaults to -1 (no gap allowed).</span>

<span class="sd">            min_overlap:</span>
<span class="sd">                Minimum overlap with query. Defaults to 0.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">            num_threads:</span>
<span class="sd">                Number of threads to use.</span>
<span class="sd">                Defaults to 1.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If ``query`` is not of type `GenomicRanges`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A BiocFrame with two columns:</span>
<span class="sd">            - query_hits: Indices into query ranges</span>
<span class="sd">            - self_hits: Corresponding indices into self ranges that are upstream</span>
<span class="sd">            Each row represents a query-self pair where self overlaps query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">OVERLAP_QUERY_TYPES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;within&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;query&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">query_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">OVERLAP_QUERY_TYPES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">query_type</span><span class="si">}</span><span class="s2">&#39; must be one of </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OVERLAP_QUERY_TYPES</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">iranges.lib_iranges</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_overlaps_groups</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">self_groups</span><span class="p">,</span> <span class="n">query_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_common_groups</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="n">all_s_hits</span><span class="p">,</span> <span class="n">all_q_hits</span> <span class="o">=</span> <span class="n">find_overlaps_groups</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">self_groups</span><span class="p">],</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">query_groups</span><span class="p">],</span>
                <span class="n">query_type</span><span class="p">,</span>
                <span class="n">select</span><span class="p">,</span>
                <span class="n">max_gap</span><span class="p">,</span>
                <span class="n">min_overlap</span><span class="p">,</span>
                <span class="n">num_threads</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">ignore_strand</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">s_strands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">all_s_hits</span><span class="p">]</span>
                <span class="n">q_strands</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">all_q_hits</span><span class="p">]</span>

                <span class="n">mask</span> <span class="o">=</span> <span class="n">s_strands</span> <span class="o">==</span> <span class="n">q_strands</span>
                <span class="c1"># to allow &#39;*&#39; with any strand from query</span>
                <span class="n">mask</span><span class="p">[</span><span class="n">s_strands</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mask</span><span class="p">[</span><span class="n">q_strands</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">all_q_hits</span> <span class="o">=</span> <span class="n">all_q_hits</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                <span class="n">all_s_hits</span> <span class="o">=</span> <span class="n">all_s_hits</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

            <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">all_q_hits</span><span class="p">,</span> <span class="n">stable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">BiocFrame</span><span class="p">({</span><span class="s2">&quot;query_hits&quot;</span><span class="p">:</span> <span class="n">all_q_hits</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="s2">&quot;self_hits&quot;</span><span class="p">:</span> <span class="n">all_s_hits</span><span class="p">[</span><span class="n">order</span><span class="p">]})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query_groups</span><span class="p">,</span> <span class="n">self_groups</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">_get_query_common_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="n">all_q_hits</span><span class="p">,</span> <span class="n">all_s_hits</span> <span class="o">=</span> <span class="n">find_overlaps_groups</span><span class="p">(</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">query_groups</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">get_end</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">self_groups</span><span class="p">],</span>
                <span class="n">query_type</span><span class="p">,</span>
                <span class="n">select</span><span class="p">,</span>
                <span class="n">max_gap</span><span class="p">,</span>
                <span class="n">min_overlap</span><span class="p">,</span>
                <span class="n">num_threads</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">ignore_strand</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">q_strands</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">all_q_hits</span><span class="p">]</span>
                <span class="n">s_strands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">all_s_hits</span><span class="p">]</span>

                <span class="n">mask</span> <span class="o">=</span> <span class="n">s_strands</span> <span class="o">==</span> <span class="n">q_strands</span>
                <span class="n">mask</span><span class="p">[</span><span class="n">q_strands</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mask</span><span class="p">[</span><span class="n">s_strands</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">all_q_hits</span> <span class="o">=</span> <span class="n">all_q_hits</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                <span class="n">all_s_hits</span> <span class="o">=</span> <span class="n">all_s_hits</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

            <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">all_q_hits</span><span class="p">,</span> <span class="n">stable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">BiocFrame</span><span class="p">({</span><span class="s2">&quot;query_hits&quot;</span><span class="p">:</span> <span class="n">all_q_hits</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="s2">&quot;self_hits&quot;</span><span class="p">:</span> <span class="n">all_s_hits</span><span class="p">[</span><span class="n">order</span><span class="p">]})</span></div>


<div class="viewcode-block" id="GenomicRanges.count_overlaps">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.count_overlaps">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">count_overlaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span>
        <span class="n">query_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;within&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
        <span class="n">max_gap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">min_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count overlaps between subject (self) and a ``query`` ``GenomicRanges`` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            query:</span>
<span class="sd">                Query `GenomicRanges`.</span>

<span class="sd">            query_type:</span>
<span class="sd">                Overlap query type, must be one of</span>

<span class="sd">                - &quot;any&quot;: Any overlap is good</span>
<span class="sd">                - &quot;start&quot;: Overlap at the beginning of the intervals</span>
<span class="sd">                - &quot;end&quot;: Must overlap at the end of the intervals</span>
<span class="sd">                - &quot;within&quot;: Fully contain the query interval</span>

<span class="sd">                Defaults to &quot;any&quot;.</span>

<span class="sd">            max_gap:</span>
<span class="sd">                Maximum gap allowed in the overlap.</span>
<span class="sd">                Defaults to -1 (no gap allowed).</span>

<span class="sd">            min_overlap:</span>
<span class="sd">                Minimum overlap with query. Defaults to 0.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">            num_threads:</span>
<span class="sd">                Number of threads to use.</span>
<span class="sd">                Defaults to 1.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If ``query`` is not of type `GenomicRanges`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumPy vector with length matching query,</span>
<span class="sd">            value represents the number of overlaps in `self` for each query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_overlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_overlaps</span><span class="p">(</span>
            <span class="n">query</span><span class="p">,</span>
            <span class="n">query_type</span><span class="o">=</span><span class="n">query_type</span><span class="p">,</span>
            <span class="n">max_gap</span><span class="o">=</span><span class="n">max_gap</span><span class="p">,</span>
            <span class="n">min_overlap</span><span class="o">=</span><span class="n">min_overlap</span><span class="p">,</span>
            <span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">,</span>
            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
        <span class="n">_ucounts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique_counts</span><span class="p">(</span><span class="n">_overlaps</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;query_hits&quot;</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="n">_ucounts</span><span class="o">.</span><span class="n">values</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ucounts</span><span class="o">.</span><span class="n">counts</span>

        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="GenomicRanges.subset_by_overlaps">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.subset_by_overlaps">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">subset_by_overlaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span>
        <span class="n">query_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;within&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
        <span class="n">max_gap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">min_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subset ``subject`` (self) with overlaps in ``query`` `GenomicRanges` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            query:</span>
<span class="sd">                Query `GenomicRanges`.</span>

<span class="sd">            query_type:</span>
<span class="sd">                Overlap query type, must be one of</span>

<span class="sd">                - &quot;any&quot;: Any overlap is good</span>
<span class="sd">                - &quot;start&quot;: Overlap at the beginning of the intervals</span>
<span class="sd">                - &quot;end&quot;: Must overlap at the end of the intervals</span>
<span class="sd">                - &quot;within&quot;: Fully contain the query interval</span>

<span class="sd">                Defaults to &quot;any&quot;.</span>

<span class="sd">            max_gap:</span>
<span class="sd">                Maximum gap allowed in the overlap.</span>
<span class="sd">                Defaults to -1 (no gap allowed).</span>

<span class="sd">            min_overlap:</span>
<span class="sd">                Minimum overlap with query. Defaults to 0.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands. Defaults to False.</span>

<span class="sd">            num_threads:</span>
<span class="sd">                Number of threads to use.</span>
<span class="sd">                Defaults to 1.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError:</span>
<span class="sd">                If ``query`` is not of type `GenomicRanges`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A ``GenomicRanges`` object containing overlapping ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_overlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_overlaps</span><span class="p">(</span>
            <span class="n">query</span><span class="p">,</span>
            <span class="n">query_type</span><span class="o">=</span><span class="n">query_type</span><span class="p">,</span>
            <span class="n">max_gap</span><span class="o">=</span><span class="n">max_gap</span><span class="p">,</span>
            <span class="n">min_overlap</span><span class="o">=</span><span class="n">min_overlap</span><span class="p">,</span>
            <span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">,</span>
            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_all_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_overlaps</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;self_hits&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">_all_indices</span><span class="p">]</span></div>


    <span class="c1">#################################</span>
    <span class="c1">######&gt;&gt; nearest methods &lt;&lt;######</span>
    <span class="c1">#################################</span>

<div class="viewcode-block" id="GenomicRanges.nearest">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.nearest">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">nearest</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span>
        <span class="n">select</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;arbitrary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;arbitrary&quot;</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">BiocFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search nearest positions both upstream and downstream that overlap with each range in ``query``.</span>

<span class="sd">        Args:</span>
<span class="sd">            query:</span>
<span class="sd">                Query ``GenomicRanges`` to find nearest positions.</span>

<span class="sd">            select:</span>
<span class="sd">                Determine what hit to choose when there are</span>
<span class="sd">                multiple hits for an interval in ``query``.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strand. Defaults to False.</span>

<span class="sd">            num_threads:</span>
<span class="sd">                Number of threads to use.</span>
<span class="sd">                Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If select=&quot;arbitrary&quot;:</span>
<span class="sd">                A numpy array of integers with length matching query, containing indices</span>
<span class="sd">                into self for the closest for each query range. Value may be None if there</span>
<span class="sd">                are no matches.</span>
<span class="sd">            If select=&quot;all&quot;:</span>
<span class="sd">                A BiocFrame with two columns:</span>
<span class="sd">                - query_hits: Indices into query ranges</span>
<span class="sd">                - self_hits: Corresponding indices into self ranges that are upstream</span>
<span class="sd">                Each row represents a query-self pair where subject is nearest to query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;query&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="n">effective_threads</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">())</span> <span class="k">if</span> <span class="n">num_threads</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">cpu_count</span><span class="p">()</span>

        <span class="n">self_groups</span><span class="p">,</span> <span class="n">query_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_common_groups</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">s_group</span><span class="p">,</span>
                <span class="n">q_group</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span>
                <span class="n">ignore_strand</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">s_group</span><span class="p">,</span> <span class="n">q_group</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">self_groups</span><span class="p">,</span> <span class="n">query_groups</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">effective_threads</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">self_groups</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapper_nearest</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">effective_threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">wrapper_nearest</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">all_qhits_list</span><span class="p">,</span> <span class="n">all_shits_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">results</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_qhits_list</span><span class="p">,</span> <span class="n">all_shits_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">final_qhits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_qhits_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_qhits_list</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">final_shits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_shits_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_shits_list</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">select</span> <span class="o">==</span> <span class="s2">&quot;arbitrary&quot;</span><span class="p">:</span>
            <span class="n">ret_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">final_shits</span><span class="p">,</span> <span class="n">final_qhits</span><span class="p">):</span>
                <span class="n">ret_result</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
            <span class="c1"># unique_q, indices = np.unique(final_qhits, return_index=True)</span>
            <span class="c1"># ret_result[unique_q] = final_shits[indices]</span>
            <span class="k">return</span> <span class="n">ret_result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BiocFrame</span><span class="p">({</span><span class="s2">&quot;query_hits&quot;</span><span class="p">:</span> <span class="n">final_qhits</span><span class="p">,</span> <span class="s2">&quot;self_hits&quot;</span><span class="p">:</span> <span class="n">final_shits</span><span class="p">})</span></div>


<div class="viewcode-block" id="GenomicRanges.precede">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.precede">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">precede</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span>
        <span class="n">select</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;first&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">BiocFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search nearest positions only downstream that overlap with each range in ``query``.</span>

<span class="sd">        Args:</span>
<span class="sd">            query:</span>
<span class="sd">                Query ``GenomicRanges`` to find nearest positions.</span>

<span class="sd">            select:</span>
<span class="sd">                Whether to return &quot;all&quot; hits or just &quot;first&quot;.</span>
<span class="sd">                Defaults to &quot;first&quot;.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strand. Defaults to False.</span>

<span class="sd">            num_threads:</span>
<span class="sd">                Number of threads to use.</span>
<span class="sd">                Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If select=&quot;first&quot;:</span>
<span class="sd">                A numpy array of integers with length matching query, containing indices</span>
<span class="sd">                into self for the closest upstream position of each query range. Value may be</span>
<span class="sd">                None if there are no matches.</span>
<span class="sd">            If select=&quot;all&quot;:</span>
<span class="sd">                A BiocFrame with two columns:</span>
<span class="sd">                - query_hits: Indices into query ranges</span>
<span class="sd">                - self_hits: Corresponding indices into self ranges that are upstream</span>
<span class="sd">                Each row represents a query-self pair where self precedes query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;query&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="n">effective_threads</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">())</span> <span class="k">if</span> <span class="n">num_threads</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">cpu_count</span><span class="p">()</span>
        <span class="n">self_groups</span><span class="p">,</span> <span class="n">query_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_common_groups</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="s2">&quot;precede&quot;</span><span class="p">,</span>
                <span class="n">s_group</span><span class="p">,</span>
                <span class="n">q_group</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span>
                <span class="n">ignore_strand</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">s_group</span><span class="p">,</span> <span class="n">q_group</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">self_groups</span><span class="p">,</span> <span class="n">query_groups</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">effective_threads</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">effective_threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">wrapper_follow_precede</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapper_follow_precede</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">all_qhits_list</span><span class="p">,</span> <span class="n">all_shits_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">results</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_qhits_list</span><span class="p">,</span> <span class="n">all_shits_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">final_qhits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_qhits_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_qhits_list</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">final_shits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_shits_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_shits_list</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">select</span> <span class="o">==</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
            <span class="n">ret_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">final_shits</span><span class="p">,</span> <span class="n">final_qhits</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ret_result</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ret_result</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
            <span class="c1"># unique_q, indices = np.unique(final_qhits, return_index=True)</span>
            <span class="c1"># ret_result[unique_q] = final_shits[indices]</span>
            <span class="k">return</span> <span class="n">ret_result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BiocFrame</span><span class="p">({</span><span class="s2">&quot;query_hits&quot;</span><span class="p">:</span> <span class="n">final_qhits</span><span class="p">,</span> <span class="s2">&quot;self_hits&quot;</span><span class="p">:</span> <span class="n">final_shits</span><span class="p">})</span></div>


<div class="viewcode-block" id="GenomicRanges.follow">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.follow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">follow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span>
        <span class="n">select</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
        <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">BiocFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search nearest positions only upstream that overlap with each range in ``query``.</span>

<span class="sd">        Args:</span>
<span class="sd">            query:</span>
<span class="sd">                Query ``GenomicRanges`` to find nearest positions.</span>

<span class="sd">            select:</span>
<span class="sd">                Whether to return &quot;all&quot; hits or just &quot;last&quot;.</span>
<span class="sd">                Defaults to &quot;last&quot;.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strand. Defaults to False.</span>

<span class="sd">            num_threads:</span>
<span class="sd">                Number of threads to use.</span>
<span class="sd">                Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If select=&quot;last&quot;:</span>
<span class="sd">                A numpy array of integers with length matching query, containing indices</span>
<span class="sd">                into self for the closest downstream position of each query range. Value may be</span>
<span class="sd">                None if there are no matches.</span>
<span class="sd">            If select=&quot;all&quot;:</span>
<span class="sd">                A BiocFrame with two columns:</span>
<span class="sd">                - query_hits: Indices into query ranges</span>
<span class="sd">                - self_hits: Corresponding indices into self ranges that are upstream</span>
<span class="sd">                Each row represents a query-self pair where self follows query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;query&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="n">effective_threads</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">())</span> <span class="k">if</span> <span class="n">num_threads</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">cpu_count</span><span class="p">()</span>
        <span class="n">self_groups</span><span class="p">,</span> <span class="n">query_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_common_groups</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="s2">&quot;follow&quot;</span><span class="p">,</span>
                <span class="n">s_group</span><span class="p">,</span>
                <span class="n">q_group</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_ranges</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span>
                <span class="n">query</span><span class="o">.</span><span class="n">_strand</span><span class="p">,</span>
                <span class="n">ignore_strand</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">s_group</span><span class="p">,</span> <span class="n">q_group</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">self_groups</span><span class="p">,</span> <span class="n">query_groups</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">effective_threads</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">effective_threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">wrapper_follow_precede</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapper_follow_precede</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">all_qhits_list</span><span class="p">,</span> <span class="n">all_shits_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">results</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_qhits_list</span><span class="p">,</span> <span class="n">all_shits_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">final_qhits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_qhits_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_qhits_list</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">final_shits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_shits_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_shits_list</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">select</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
            <span class="n">ret_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">final_qhits</span><span class="p">,</span> <span class="n">final_shits</span><span class="p">):</span>
                <span class="n">ret_result</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
            <span class="k">return</span> <span class="n">ret_result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BiocFrame</span><span class="p">({</span><span class="s2">&quot;query_hits&quot;</span><span class="p">:</span> <span class="n">final_qhits</span><span class="p">,</span> <span class="s2">&quot;self_hits&quot;</span><span class="p">:</span> <span class="n">final_shits</span><span class="p">})</span></div>


<div class="viewcode-block" id="GenomicRanges.distance">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.distance">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span> <span class="n">IRanges</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the pair-wise distance with intervals in query.</span>

<span class="sd">        Args:</span>
<span class="sd">            query:</span>
<span class="sd">                Query `GenomicRanges` or `IRanges`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Numpy vector containing distances for each interval in query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">IRanges</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;query&#39; is neither a `GenomicRanges` nor `IRanges` object.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;query&#39; does not contain the same number of ranges.&quot;</span><span class="p">)</span>

        <span class="n">_qranges</span> <span class="o">=</span> <span class="n">query</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="n">_qranges</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">get_ranges</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">_qranges</span><span class="p">)</span></div>


    <span class="c1">#############################</span>
    <span class="c1">######&gt;&gt; comparisons &lt;&lt;######</span>
    <span class="c1">#############################</span>

<div class="viewcode-block" id="GenomicRanges.match">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.match">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Element wise comparison to find exact match ranges.</span>

<span class="sd">        Args:</span>
<span class="sd">            query:</span>
<span class="sd">                Query ``GenomicRanges`` to search for matches.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strand. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A NumPy array with length matching query</span>
<span class="sd">            containing the matched indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;query&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">all_overlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_overlaps</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>

        <span class="n">ol_query</span> <span class="o">=</span> <span class="n">all_overlaps</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;query_hits&quot;</span><span class="p">)</span>
        <span class="n">ol_subject</span> <span class="o">=</span> <span class="n">all_overlaps</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;self_hits&quot;</span><span class="p">)</span>

        <span class="n">unique_queries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ol_query</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">unique_queries</span><span class="p">:</span>
            <span class="n">q_ctx</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="n">q</span><span class="p">]</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ol_query</span> <span class="o">==</span> <span class="n">q</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">self_indices</span> <span class="o">=</span> <span class="n">ol_subject</span><span class="p">[</span><span class="n">matches</span><span class="p">]</span>
            <span class="n">self_matches</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">ol_subject</span><span class="p">[</span><span class="n">matches</span><span class="p">]]</span>

            <span class="n">tgt</span> <span class="o">=</span> <span class="n">self_indices</span><span class="p">[</span>
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">self_matches</span><span class="o">.</span><span class="n">get_start</span><span class="p">())</span> <span class="o">==</span> <span class="n">q_ctx</span><span class="o">.</span><span class="n">get_start</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">self_matches</span><span class="o">.</span><span class="n">get_end</span><span class="p">())</span> <span class="o">==</span> <span class="n">q_ctx</span><span class="o">.</span><span class="n">get_end</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">tgt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">result</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_get_ranges_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal method to get ranges as a list of tuples.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of tuples containing the start, end and the index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">strands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">strands</span><span class="p">[</span><span class="n">strands</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">strands</span><span class="p">[</span><span class="n">strands</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">strands</span><span class="p">[</span><span class="n">strands</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_seqnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">strands</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">_start</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">i</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">ranges</span>

<div class="viewcode-block" id="GenomicRanges.order">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.order">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decreasing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the order of indices for sorting.</span>

<span class="sd">        Order orders the genomic ranges by chromosome and strand.</span>
<span class="sd">        Strand is ordered by reverse first (-1), any strand (0) and</span>
<span class="sd">        forward strand (-1). Then by the start positions and width if</span>
<span class="sd">        two regions have the same start.</span>

<span class="sd">        Args:</span>
<span class="sd">            decreasing:</span>
<span class="sd">                Whether to sort in descending order. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumPy vector containing index positions in the sorted order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intvals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_ranges_as_list</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="n">decreasing</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">intvals</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">order</span><span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.sort">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.sort">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decreasing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the order of indices for sorting.</span>

<span class="sd">        Args:</span>
<span class="sd">            decreasing:</span>
<span class="sd">                Whether to sort in descending order. Defaults to False.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the object in place. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object with the trimmed regions,</span>
<span class="sd">            either as a copy of the original or as a reference to the</span>
<span class="sd">            (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="n">decreasing</span><span class="o">=</span><span class="n">decreasing</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">order</span><span class="p">)]</span></div>


<div class="viewcode-block" id="GenomicRanges.rank">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.rank">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get rank of the ``GenomicRanges`` object.</span>

<span class="sd">        For each range identifies its position is a sorted order.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Numpy vector containing rank.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intvals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_ranges_as_list</span><span class="p">())</span>
        <span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">intvals</span><span class="p">]</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">))]</span>
        <span class="k">return</span> <span class="n">rank</span></div>


    <span class="c1">##############################</span>
    <span class="c1">######&gt;&gt; misc methods &lt;&lt;######</span>
    <span class="c1">##############################</span>

<div class="viewcode-block" id="GenomicRanges.sample">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.sample">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Randomly sample ``k`` intervals.</span>

<span class="sd">        Args:</span>
<span class="sd">            k:</span>
<span class="sd">                Number of intervals to sample. Defaults to 5.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` with randomly sampled ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">sample</span>

        <span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span></div>


<div class="viewcode-block" id="GenomicRanges.invert_strand">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.invert_strand">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">invert_strand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Invert strand for each range.</span>

<span class="sd">        Conversion map:</span>
<span class="sd">            - &quot;+&quot; map to &quot;-&quot;</span>
<span class="sd">            - &quot;-&quot; becomes &quot;+&quot;</span>
<span class="sd">            - &quot;*&quot; stays the same</span>

<span class="sd">        Args:</span>
<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify the object in place. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``GenomicRanges`` object with the trimmed regions,</span>
<span class="sd">            either as a copy of the original or as a reference to the</span>
<span class="sd">            (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">convertor</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">}</span>
        <span class="n">inverts</span> <span class="o">=</span> <span class="p">[</span><span class="n">convertor</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">]</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_strand</span> <span class="o">=</span> <span class="n">inverts</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="c1">################################</span>
    <span class="c1">######&gt;&gt; window methods &lt;&lt;######</span>
    <span class="c1">################################</span>

<div class="viewcode-block" id="GenomicRanges.tile">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.tile">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;GenomicRanges&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split each interval by ``n`` (number of sub intervals) or ``width`` (intervals with equal width).</span>

<span class="sd">        Note: Either ``n`` or ``width`` must be provided but not both.</span>

<span class="sd">        Also, checkout :py:func:`~genomicranges.io.tiling.tile_genome` for splitting</span>
<span class="sd">        a genome into chunks.</span>

<span class="sd">        Args:</span>
<span class="sd">            n:</span>
<span class="sd">                Number of intervals to split into.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">            width:</span>
<span class="sd">                Width of each interval. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError:</span>
<span class="sd">                If both ``n`` and ``width`` are provided.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of ``GenomicRanges`` with the split ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;either `n` or `width` must be provided but not both&quot;</span><span class="p">)</span>

        <span class="n">range_tiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="n">seqnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">num_tiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_tiles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">GenomicRanges</span><span class="p">(</span>
                    <span class="n">seqnames</span><span class="o">=</span><span class="p">[</span><span class="n">seqnames</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">num_tiles</span><span class="p">,</span>
                    <span class="n">ranges</span><span class="o">=</span><span class="n">range_tiles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">strand</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">num_tiles</span><span class="p">),</span>
                    <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_tiles</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="GenomicRanges.sliding_windows">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.sliding_windows">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sliding_windows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;GenomicRanges&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Slide along each range by ``width`` (intervals with equal ``width``) and ``step``.</span>

<span class="sd">        Also, checkout :py:func:`~genomicranges.io.tiling.tile_genome` for splitting</span>
<span class="sd">        a gneomic into chunks, or</span>
<span class="sd">        :py:meth:`~genomicranges.GenomicRanges.GenomicRanges.tile_by_range`.</span>

<span class="sd">        Args:</span>
<span class="sd">            n:</span>
<span class="sd">                Number of intervals to split into.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">            width:</span>
<span class="sd">                Width of each interval. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new ``GenomicRanges`` with the sliding ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">range_windows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranges</span><span class="o">.</span><span class="n">sliding_windows</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
        <span class="n">seqnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">num_tiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_windows</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">GenomicRanges</span><span class="p">(</span>
                    <span class="n">seqnames</span><span class="o">=</span><span class="p">[</span><span class="n">seqnames</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">num_tiles</span><span class="p">,</span>
                    <span class="n">ranges</span><span class="o">=</span><span class="n">range_windows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">strand</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_strand</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">num_tiles</span><span class="p">),</span>
                    <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_tiles</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">seqinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_seqinfo</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>


    <span class="c1"># TODO: should really be a genomicrangeslist</span>
<div class="viewcode-block" id="GenomicRanges.tile_genome">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.tile_genome">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tile_genome</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">seqlengths</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">ntile</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tilewidth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cut_last_tile_in_chrom</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tile genome into approximately equal-sized regions.</span>

<span class="sd">        Args:</span>
<span class="sd">            seqlengths:</span>
<span class="sd">                Dictionary of sequence lengths by chromosome.</span>

<span class="sd">            ntile:</span>
<span class="sd">                Number of tiles (exclusive with tilewidth).</span>

<span class="sd">            tilewidth:</span>
<span class="sd">                Width of tiles (exclusive with ntile).</span>

<span class="sd">            cut_last_tile_in_chrom:</span>
<span class="sd">                Whether to cut the last tile in each chromosome.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `GenomicRanges` object with ranges and bin numbers in mcols.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ntile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tilewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;only one of &#39;ntile&#39; and &#39;tilewidth&#39; can be specified&quot;</span><span class="p">)</span>

        <span class="n">seqlen_</span> <span class="o">=</span> <span class="n">seqlengths</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seqlengths</span><span class="p">,</span> <span class="n">SeqInfo</span><span class="p">):</span>
            <span class="n">seqlen_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">seqlengths</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">(),</span> <span class="n">seqlengths</span><span class="o">.</span><span class="n">seqlengths</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">seqlen_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;seqlengths must be non-empty&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">seqlen_</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;seqlengths contains zero or negative values&quot;</span><span class="p">)</span>

        <span class="n">chroms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">seqlen_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">seqlen_</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chroms</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">chrom_ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
        <span class="c1"># chrom_starts = np.r_[0, chrom_ends[:-1]]</span>
        <span class="n">genome_size</span> <span class="o">=</span> <span class="n">chrom_ends</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ntile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cut_last_tile_in_chrom</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cut_last_tile_in_chrom must be FALSE when ntile is supplied&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ntile</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="ow">or</span> <span class="n">ntile</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ntile</span> <span class="o">&gt;</span> <span class="n">genome_size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ntile must be an integer &gt;= 1 and &lt;= genome size&quot;</span><span class="p">)</span>

            <span class="n">tilewidth</span> <span class="o">=</span> <span class="n">genome_size</span> <span class="o">/</span> <span class="n">ntile</span>
            <span class="n">genome_breaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">tilewidth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ntile</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

            <span class="n">all_chroms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_starts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_widths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_abs_starts</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># track absolute starts</span>
            <span class="n">all_abs_ends</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># track absolute ends</span>

            <span class="n">prev_end</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lengths</span><span class="p">):</span>
                <span class="n">curr_end</span> <span class="o">=</span> <span class="n">prev_end</span> <span class="o">+</span> <span class="n">length</span>

                <span class="n">chr_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">genome_breaks</span> <span class="o">&gt;</span> <span class="n">prev_end</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">genome_breaks</span> <span class="o">&lt;=</span> <span class="n">curr_end</span><span class="p">)</span>
                <span class="n">chr_breaks</span> <span class="o">=</span> <span class="n">genome_breaks</span><span class="p">[</span><span class="n">chr_mask</span><span class="p">]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chr_breaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Handle first tile in chromosome</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_starts</span> <span class="ow">or</span> <span class="n">genome_breaks</span><span class="p">[</span><span class="n">chr_mask</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">prev_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">all_chroms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chroms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">chr_breaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_end</span>
                        <span class="n">all_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                        <span class="n">all_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
                        <span class="n">all_abs_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prev_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">all_abs_ends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chr_breaks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                    <span class="c1"># Handle remaining tiles in chromosome</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">chr_breaks</span><span class="p">)):</span>
                        <span class="n">all_chroms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chroms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">chr_breaks</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_end</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">chr_breaks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_end</span>
                        <span class="n">all_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                        <span class="n">all_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">all_abs_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chr_breaks</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">all_abs_ends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chr_breaks</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                <span class="n">prev_end</span> <span class="o">=</span> <span class="n">curr_end</span>

                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chr_breaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">chr_breaks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">curr_end</span><span class="p">):</span>
                    <span class="n">all_chroms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chroms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chr_breaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">chr_breaks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_end</span> <span class="o">+</span> <span class="n">length</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">all_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                    <span class="n">width</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">all_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chr_breaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">all_abs_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chr_breaks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">all_abs_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prev_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">all_abs_ends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_end</span><span class="p">)</span>

            <span class="n">all_abs_starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_abs_starts</span><span class="p">)</span>
            <span class="n">all_abs_ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_abs_ends</span><span class="p">)</span>

            <span class="n">bin_width</span> <span class="o">=</span> <span class="n">genome_size</span> <span class="o">/</span> <span class="n">ntile</span>
            <span class="n">bin_starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">genome_size</span><span class="p">,</span> <span class="n">bin_width</span><span class="p">)</span>
            <span class="n">bin_ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bin_starts</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">genome_size</span><span class="p">)</span>

            <span class="n">all_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_abs_starts</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_abs_starts</span><span class="p">)):</span>
                <span class="n">range_start</span> <span class="o">=</span> <span class="n">all_abs_starts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">range_end</span> <span class="o">=</span> <span class="n">all_abs_ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">overlaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">bin_ends</span><span class="p">,</span> <span class="n">range_end</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">bin_starts</span><span class="p">,</span> <span class="n">range_start</span><span class="p">)</span>
                <span class="n">overlaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">overlaps</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">all_bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">overlaps</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tilewidth</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="ow">or</span> <span class="n">tilewidth</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">tilewidth</span> <span class="o">&gt;</span> <span class="n">genome_size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tilewidth must be an integer &gt;= 1 and &lt;= genome size&quot;</span><span class="p">)</span>

            <span class="n">ntile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">genome_size</span> <span class="o">/</span> <span class="n">tilewidth</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">GenomicRanges</span><span class="o">.</span><span class="n">tile_genome</span><span class="p">(</span><span class="n">seqlen_</span><span class="p">,</span> <span class="n">ntile</span><span class="o">=</span><span class="n">ntile</span><span class="p">,</span> <span class="n">cut_last_tile_in_chrom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ranges</span> <span class="o">=</span> <span class="n">IRanges</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_starts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_widths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
        <span class="n">mcols</span> <span class="o">=</span> <span class="n">BiocFrame</span><span class="p">({</span><span class="s2">&quot;bin&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_bins</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)})</span>
        <span class="k">return</span> <span class="n">GenomicRanges</span><span class="p">(</span><span class="n">seqnames</span><span class="o">=</span><span class="n">all_chroms</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_starts</span><span class="p">),</span> <span class="n">mcols</span><span class="o">=</span><span class="n">mcols</span><span class="p">)</span></div>


<div class="viewcode-block" id="GenomicRanges.binned_average">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.binned_average">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">binned_average</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scorename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">bins</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span>
        <span class="n">outname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;binned_average&quot;</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate average for a column across all regions in ``bins``, then set a column specified by &#39;outname&#39; with</span>
<span class="sd">        those values.</span>

<span class="sd">        Args:</span>
<span class="sd">            scorename:</span>
<span class="sd">                Score column to compute averages on.</span>

<span class="sd">            bins:</span>
<span class="sd">                Bins you want to use.</span>

<span class="sd">            outname:</span>
<span class="sd">                New column name to add to the object.</span>

<span class="sd">            in_place:</span>
<span class="sd">                Whether to modify ``bins`` in place.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError:</span>
<span class="sd">                If ``scorename`` column does not exist.</span>
<span class="sd">                ``scorename`` is not all ints or floats.</span>
<span class="sd">            TypeError:</span>
<span class="sd">                If ``bins`` is not of type `GenomicRanges`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A modified ``bins`` object with the computed averages,</span>
<span class="sd">            either as a copy of the original or as a reference to the</span>
<span class="sd">            (in-place-modified) original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">GenomicRanges</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;bins&#39; is not a `GenomicRanges` object.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scorename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">column_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">scorename</span><span class="si">}</span><span class="s2">&#39; is not a valid column name&quot;</span><span class="p">)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">scorename</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">scorename</span><span class="si">}</span><span class="s2">&#39; values must be either `ints` or `floats`.&quot;</span><span class="p">)</span>

        <span class="n">outvec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span>
            <span class="n">overlap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subset_by_overlaps</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
            <span class="n">outvec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">overlap</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">scorename</span><span class="p">)))</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">bins</span><span class="o">.</span><span class="n">_define_output</span><span class="p">(</span><span class="n">in_place</span><span class="o">=</span><span class="n">in_place</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">_mcols</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="n">outvec</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>


    <span class="c1">#######################</span>
    <span class="c1">######&gt;&gt; split &lt;&lt;######</span>
    <span class="c1">#######################</span>

<div class="viewcode-block" id="GenomicRanges.split">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.split">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRangesList&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the `GenomicRanges` object into a :py:class:`~genomicranges.GenomicRangesList.GenomicRangesList`.</span>

<span class="sd">        Args:</span>
<span class="sd">            groups:</span>
<span class="sd">                A list specifying the groups or factors to split by.</span>

<span class="sd">                Must have the same length as the number of genomic elements</span>
<span class="sd">                in the object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A `GenomicRangesList` containing the groups and their</span>
<span class="sd">            corresponding elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of groups must match the number of genomic elements.&quot;</span><span class="p">)</span>

        <span class="n">gdict</span> <span class="o">=</span> <span class="n">group_by_indices</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">)</span>

        <span class="n">_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_grs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">gdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">_grs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.GenomicRangesList</span><span class="w"> </span><span class="kn">import</span> <span class="n">GenomicRangesList</span>

        <span class="k">return</span> <span class="n">GenomicRangesList</span><span class="p">(</span><span class="n">ranges</span><span class="o">=</span><span class="n">_grs</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">_names</span><span class="p">)</span></div>


    <span class="c1">#######################</span>
    <span class="c1">######&gt;&gt; empty &lt;&lt;######</span>
    <span class="c1">#######################</span>

<div class="viewcode-block" id="GenomicRanges.empty">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.empty">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an zero-length `GenomicRanges` object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            same type as caller, in this case a `GenomicRanges`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">([],</span> <span class="n">IRanges</span><span class="o">.</span><span class="n">empty</span><span class="p">())</span></div>


    <span class="c1">##########################</span>
    <span class="c1">######&gt;&gt; subtract &lt;&lt;######</span>
    <span class="c1">##########################</span>

<div class="viewcode-block" id="GenomicRanges.subtract">
<a class="viewcode-back" href="../../api/genomicranges.html#genomicranges.GenomicRanges.GenomicRanges.subtract">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">subtract</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;GenomicRanges&quot;</span><span class="p">,</span> <span class="n">min_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenomicRangesList&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subtract searches for features in ``x`` that overlap ``self`` by at least the number of base pairs given by</span>
<span class="sd">        ``min_overlap``.</span>

<span class="sd">        Args:</span>
<span class="sd">            other:</span>
<span class="sd">                Object to subtract.</span>

<span class="sd">            min_overlap:</span>
<span class="sd">                Minimum overlap with query.</span>
<span class="sd">                Defaults to 1.</span>

<span class="sd">            ignore_strand:</span>
<span class="sd">                Whether to ignore strands.</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A `GenomicRangesList` with the same size as ``self`` containing</span>
<span class="sd">            the subtracted regions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_other_reduce</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">_other_reduce</span><span class="o">.</span><span class="n">find_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_overlap</span><span class="o">=</span><span class="n">min_overlap</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="o">=</span><span class="n">ignore_strand</span><span class="p">)</span>

        <span class="n">mapper</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">mapper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)):</span>
            <span class="n">s_hit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hits</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;self_hits&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">q_hit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hits</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;query_hits&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">mapper</span><span class="p">[</span><span class="n">q_hit</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_hit</span><span class="p">)</span>

        <span class="n">mapper_with_y</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">mapper_with_y</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>

        <span class="n">psetdiff</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mapper_with_y</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">psetdiff</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">psetdiff</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setdiff</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.GenomicRangesList</span><span class="w"> </span><span class="kn">import</span> <span class="n">GenomicRangesList</span>

        <span class="k">return</span> <span class="n">GenomicRangesList</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">psetdiff</span><span class="p">)</span></div>
</div>



<span class="k">def</span><span class="w"> </span><span class="nf">_fast_combine_GenomicRanges</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="n">GenomicRanges</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenomicRanges</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">GenomicRanges</span><span class="p">(</span>
        <span class="n">ranges</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">_ranges</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]),</span>
        <span class="n">seqnames</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">()</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]),</span>
        <span class="n">strand</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">_strand</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]),</span>
        <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mcols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seqinfo</span><span class="o">=</span><span class="n">merge_SeqInfo</span><span class="p">([</span><span class="n">y</span><span class="o">.</span><span class="n">_seqinfo</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]),</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>


<span class="nd">@ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">GenomicRanges</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_combine_GenomicRanges</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="n">GenomicRanges</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenomicRanges</span><span class="p">:</span>
    <span class="n">has_names</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">has_names</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

    <span class="n">all_names</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">has_names</span><span class="p">:</span>
        <span class="n">all_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">all_names</span> <span class="o">+=</span> <span class="n">y</span><span class="o">.</span><span class="n">_names</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_names</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">GenomicRanges</span><span class="p">(</span>
        <span class="n">ranges</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">_ranges</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]),</span>
        <span class="n">seqnames</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">get_seqnames</span><span class="p">()</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]),</span>
        <span class="n">strand</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">combine_sequences</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">_strand</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]),</span>
        <span class="n">names</span><span class="o">=</span><span class="n">all_names</span><span class="p">,</span>
        <span class="n">mcols</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">relaxed_combine_rows</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">_mcols</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]),</span>
        <span class="n">seqinfo</span><span class="o">=</span><span class="n">merge_SeqInfo</span><span class="p">([</span><span class="n">y</span><span class="o">.</span><span class="n">_seqinfo</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]),</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>


<span class="nd">@ut</span><span class="o">.</span><span class="n">extract_row_names</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">GenomicRanges</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_rownames_gr</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">GenomicRanges</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">get_names</span><span class="p">()</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, jkanche
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=6dfdf7c3"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>